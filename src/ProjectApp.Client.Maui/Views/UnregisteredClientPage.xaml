<?xml version="1.0" encoding="utf-8"?>
<TabbedPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            xmlns:viewModels="clr-namespace:ProjectApp.Client.Maui.ViewModels"
            xmlns:services="clr-namespace:ProjectApp.Client.Maui.Services"
            x:Class="ProjectApp.Client.Maui.Views.UnregisteredClientPage"
            x:DataType="viewModels:UnregisteredClientViewModel"
            Title="Нерегистрированные клиенты">
  <TabbedPage.ToolbarItems>
    <ToolbarItem Text="Обновить всё"
                 Command="{Binding RefreshAllCommand}"
                 IconImageSource="{StaticResource IconRefresh}" />
  </TabbedPage.ToolbarItems>

  <ContentPage Title="Продажи"
               BindingContext="{Binding Source={RelativeSource AncestorType={x:Type TabbedPage}}}">
    <Grid Padding="16" RowDefinitions="Auto,*" RowSpacing="10">
      <HorizontalStackLayout Grid.Row="0" Spacing="8" VerticalOptions="Center">
        <Label Text="с" VerticalTextAlignment="Center" />
        <DatePicker Date="{Binding DateFrom}" />
        <Label Text="по" VerticalTextAlignment="Center" />
        <DatePicker Date="{Binding DateTo}" />
        <Button Text="Обновить"
                Command="{Binding RefreshSalesCommand}"
                ImageSource="{StaticResource IconRefresh}"
                ContentLayout="Left,8" />
      </HorizontalStackLayout>

      <CollectionView Grid.Row="1" ItemsSource="{Binding Sales}">
        <CollectionView.ItemTemplate>
          <DataTemplate x:DataType="services:ApiClientsService+SaleBriefDto">
            <Frame Padding="10" HasShadow="False" CornerRadius="10">
              <VerticalStackLayout Spacing="6">
                <Label Text="{Binding Id, StringFormat='Продажа #{0}'}" FontAttributes="Bold" />
                <Label Text="{Binding CreatedAt, Converter={StaticResource DateTimeToRuConverter}}"
                       FontSize="12"
                       TextColor="Gray" />
                <Label Text="{Binding PaymentType, Converter={StaticResource PaymentTypeToRuConverter}, StringFormat='Способ: {0}'}" />
                <Label Text="{Binding Total, Converter={StaticResource CurrencyConverter}, StringFormat='Итого: {0}'}" />
              </VerticalStackLayout>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
        <CollectionView.EmptyView>
          <VerticalStackLayout Padding="12" Spacing="6">
            <Label Text="Продаж нет" FontAttributes="Bold" TextColor="{StaticResource MutedTextColor}" />
            <Label Text="Попробуйте изменить период" FontSize="12" TextColor="{StaticResource MutedTextColor}" />
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>
    </Grid>
  </ContentPage>

  <ContentPage Title="Возвраты"
               BindingContext="{Binding Source={RelativeSource AncestorType={x:Type TabbedPage}}}">
    <Grid Padding="16" RowDefinitions="Auto,*" RowSpacing="10">
      <HorizontalStackLayout Grid.Row="0" Spacing="8" VerticalOptions="Center">
        <Label Text="с" VerticalTextAlignment="Center" />
        <DatePicker Date="{Binding DateFrom}" />
        <Label Text="по" VerticalTextAlignment="Center" />
        <DatePicker Date="{Binding DateTo}" />
        <Button Text="Обновить"
                Command="{Binding RefreshReturnsCommand}"
                ImageSource="{StaticResource IconRefresh}"
                ContentLayout="Left,8" />
      </HorizontalStackLayout>

      <CollectionView Grid.Row="1" ItemsSource="{Binding Returns}">
        <CollectionView.ItemTemplate>
          <DataTemplate x:DataType="services:ApiClientsService+ReturnBriefDto">
            <Frame Padding="10" HasShadow="False" CornerRadius="10">
              <VerticalStackLayout Spacing="6">
                <Label Text="{Binding Id, StringFormat='Возврат #{0}'}" FontAttributes="Bold" />
                <Label Text="{Binding CreatedAt, Converter={StaticResource DateTimeToRuConverter}}"
                       FontSize="12"
                       TextColor="Gray" />
                <Label Text="{Binding Sum, Converter={StaticResource CurrencyConverter}, StringFormat='Сумма: {0}'}" />
                <Label Text="{Binding Reason, StringFormat='Причина: {0}'}" />
              </VerticalStackLayout>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
        <CollectionView.EmptyView>
          <VerticalStackLayout Padding="12" Spacing="6">
            <Label Text="Возвратов нет" FontAttributes="Bold" TextColor="{StaticResource MutedTextColor}" />
            <Label Text="Попробуйте изменить период" FontSize="12" TextColor="{StaticResource MutedTextColor}" />
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>
    </Grid>
  </ContentPage>
</TabbedPage>
