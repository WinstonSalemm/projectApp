<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.RefillsPage"
             x:DataType="vm:RefillsViewModel"
             Title="ðŸ”¥ ÐŸÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐ°">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ" Command="{Binding LoadRefillsCommand}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="20">

            <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                             IsVisible="{Binding IsLoading}"
                             HeightRequest="50" />

            <!-- Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ -->
            <Frame BackgroundColor="#FFF3E0" 
                   BorderColor="#FF9800"
                   CornerRadius="12"
                   Padding="16">
                <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                    <VerticalStackLayout Grid.Column="0" Spacing="4">
                        <Label Text="ðŸ’° Ð’ÑÐµÐ³Ð¾ Ð¿Ð¾Ñ‚Ñ€Ð°Ñ‡ÐµÐ½Ð¾:"
                               FontSize="12"
                               TextColor="#F57C00" />
                        <Label Text="{Binding TotalCostFormatted}"
                               FontSize="20"
                               TextColor="#E65100"
                               FontFamily="InterBold" />
                    </VerticalStackLayout>
                    
                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                        <Label Text="ðŸ“Š ÐŸÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ¶ÐµÐ½Ð¾:"
                               FontSize="12"
                               TextColor="#F57C00" />
                        <Label Text="{Binding TotalQuantity, StringFormat='{0} ÑˆÑ‚.'}"
                               FontSize="20"
                               TextColor="#E65100"
                               FontFamily="InterBold" />
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Ð¤ÐžÐ ÐœÐ ÐŸÐ•Ð Ð•Ð—ÐÐ Ð¯Ð”ÐšÐ˜ -->
            <Frame BackgroundColor="White" 
                   BorderColor="#4CAF50"
                   CornerRadius="12"
                   Padding="20">
                <VerticalStackLayout Spacing="16">
                    <Label Text="ðŸ”¥ ÐÐ¾Ð²Ð°Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐ°"
                           FontSize="18"
                           TextColor="#212121"
                           FontFamily="InterBold" />

                    <!-- Ð¢Ð¾Ð²Ð°Ñ€ -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="ID Ð¢Ð¾Ð²Ð°Ñ€Ð° (Ð¾Ð³Ð½ÐµÑ‚ÑƒÑˆÐ¸Ñ‚ÐµÐ»ÑŒ):"
                               FontSize="13"
                               TextColor="#757575" />
                        <Entry Text="{Binding ProductIdText}"
                               Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ID Ñ‚Ð¾Ð²Ð°Ñ€Ð°"
                               Keyboard="Numeric"
                               FontSize="16"
                               BackgroundColor="#F5F5F5"
                               TextColor="#212121" />
                        <Label Text="{Binding SelectedProductName}"
                               FontSize="12"
                               TextColor="#2196F3"
                               IsVisible="{Binding SelectedProductName, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                               Margin="4,4,0,0" />
                    </VerticalStackLayout>

                    <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾:"
                               FontSize="13"
                               TextColor="#757575" />
                        <Entry Text="{Binding Quantity}"
                               Placeholder="1"
                               Keyboard="Numeric"
                               FontSize="16"
                               BackgroundColor="#F5F5F5"
                               TextColor="#212121" />
                    </VerticalStackLayout>

                    <!-- Ð¡ÐºÐ»Ð°Ð´ -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Ð¡ÐºÐ»Ð°Ð´:"
                               FontSize="13"
                               TextColor="#757575" />
                        <Button Text="{Binding WarehouseName}"
                                Command="{Binding ToggleWarehouseCommand}"
                                BackgroundColor="#2196F3"
                                TextColor="White"
                                FontFamily="InterSemiBold"
                                FontSize="14"
                                Padding="12"
                                CornerRadius="8" />
                    </VerticalStackLayout>

                    <!-- Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð° ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐ¸ Ð·Ð° 1 ÑˆÑ‚. (UZS):"
                               FontSize="13"
                               TextColor="#757575" />
                        <Entry Text="{Binding CostPerUnitText}"
                               Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 50000"
                               Keyboard="Numeric"
                               FontSize="16"
                               BackgroundColor="#F5F5F5"
                               TextColor="#212121" />
                    </VerticalStackLayout>

                    <!-- ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ -->
                    <Frame BackgroundColor="#E8F5E9"
                           Padding="12"
                           CornerRadius="8"
                           BorderColor="#4CAF50">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="ðŸ’° ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:"
                                   FontSize="14"
                                   TextColor="#2E7D32"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding TotalCostText}"
                                   FontSize="18"
                                   TextColor="#1B5E20"
                                   FontFamily="InterBold"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ -->
                    <VerticalStackLayout Spacing="4">
                        <Label Text="ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾):"
                               FontSize="13"
                               TextColor="#757575" />
                        <Editor Text="{Binding Notes}"
                                Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: ÐŸÐ»Ð°Ð½Ð¾Ð²Ð°Ñ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐ° Ð¾Ð³Ð½ÐµÑ‚ÑƒÑˆÐ¸Ñ‚ÐµÐ»ÐµÐ¹"
                                HeightRequest="80"
                                FontSize="14"
                                BackgroundColor="#F5F5F5"
                                TextColor="#212121" />
                    </VerticalStackLayout>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° -->
                    <Button Text="ðŸ”¥ Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÑƒ"
                            Command="{Binding CreateRefillCommand}"
                            IsEnabled="{Binding CanSubmit}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"
                            FontFamily="InterBold"
                            FontSize="16"
                            Padding="0,14"
                            CornerRadius="8" />

                    <Label Text="â„¹ï¸ Ð¢Ð¾Ð²Ð°Ñ€ ÐÐ• ÑÐ¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ÑÑ ÑÐ¾ ÑÐºÐ»Ð°Ð´Ð°"
                           FontSize="11"
                           TextColor="#2196F3"
                           HorizontalOptions="Center"
                           FontStyle="Italic" />
                </VerticalStackLayout>
            </Frame>

            <!-- Ð˜Ð¡Ð¢ÐžÐ Ð˜Ð¯ ÐŸÐ•Ð Ð•Ð—ÐÐ Ð¯Ð”ÐžÐš -->
            <Label Text="ðŸ“œ Ð˜Ð¡Ð¢ÐžÐ Ð˜Ð¯ ÐŸÐ•Ð Ð•Ð—ÐÐ Ð¯Ð”ÐžÐš"
                   FontSize="16"
                   TextColor="#424242"
                   FontFamily="InterBold"
                   Margin="0,12,0,0" />

            <CollectionView ItemsSource="{Binding Refills}"
                          EmptyView="ÐÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¾ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐµ">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:RefillRow">
                        <Frame Margin="0,0,0,12"
                               Padding="16"
                               BackgroundColor="White"
                               BorderColor="#E0E0E0"
                               CornerRadius="8">
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" 
                                  ColumnDefinitions="120,*"
                                  RowSpacing="8">
                                
                                <!-- Ð¢Ð¾Ð²Ð°Ñ€ -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="ðŸ”¥ Ð¢Ð¾Ð²Ð°Ñ€:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="0" Grid.Column="1"
                                       Text="{Binding ProductName}"
                                       FontSize="12"
                                       TextColor="#212121"
                                       FontFamily="InterSemiBold" />

                                <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ -->
                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="ðŸ“Š ÐšÐ¾Ð»-Ð²Ð¾:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="1" Grid.Column="1"
                                       Text="{Binding Quantity, StringFormat='{0} ÑˆÑ‚.'}"
                                       FontSize="12"
                                       TextColor="#4CAF50"
                                       FontFamily="InterSemiBold" />

                                <!-- Ð¡ÐºÐ»Ð°Ð´ -->
                                <Label Grid.Row="2" Grid.Column="0"
                                       Text="ðŸ¢ Ð¡ÐºÐ»Ð°Ð´:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="2" Grid.Column="1"
                                       Text="{Binding Warehouse}"
                                       FontSize="12"
                                       TextColor="#212121" />

                                <!-- Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð° ÑˆÑ‚ -->
                                <Label Grid.Row="3" Grid.Column="0"
                                       Text="ðŸ’µ Ð—Ð° ÑˆÑ‚.:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="3" Grid.Column="1"
                                       Text="{Binding CostPerUnit}"
                                       FontSize="12"
                                       TextColor="#FF9800"
                                       FontFamily="InterSemiBold" />

                                <!-- ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ -->
                                <Label Grid.Row="4" Grid.Column="0"
                                       Text="ðŸ’° Ð’ÑÐµÐ³Ð¾:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="4" Grid.Column="1"
                                       Text="{Binding TotalCost}"
                                       FontSize="12"
                                       TextColor="#E65100"
                                       FontFamily="InterBold" />

                                <!-- ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ -->
                                <Label Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding Notes}"
                                       FontSize="11"
                                       TextColor="#9E9E9E"
                                       FontStyle="Italic"
                                       IsVisible="{Binding Notes, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                       LineBreakMode="WordWrap"
                                       Margin="0,4,0,0" />

                                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                                <Label Grid.Row="6" Grid.Column="0"
                                       Text="âš¡ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:"
                                       FontSize="12"
                                       TextColor="#757575" />
                                <Label Grid.Row="6" Grid.Column="1"
                                       Text="{Binding Status}"
                                       FontSize="12"
                                       TextColor="{Binding StatusColor}"
                                       FontFamily="InterSemiBold" />

                                <!-- Ð”Ð°Ñ‚Ð° -->
                                <Label Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="2"
                                       FontSize="11"
                                       TextColor="#9E9E9E">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="ðŸ“… " />
                                            <Span Text="{Binding CreatedAt}" />
                                            <Span Text=" / " />
                                            <Span Text="{Binding CreatedBy}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ -->
                                <Button Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="2"
                                        Text="âŒ ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:RefillsViewModel}}, Path=CancelRefillCommand}"
                                        CommandParameter="{Binding .}"
                                        IsVisible="{Binding CanCancel}"
                                        BackgroundColor="#FF5722"
                                        TextColor="White"
                                        FontSize="13"
                                        Padding="0,8"
                                        CornerRadius="6"
                                        Margin="0,8,0,0" />
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ÐŸÑƒÑÑ‚Ð¾Ðµ Ð¼ÐµÑÑ‚Ð¾ Ð²Ð½Ð¸Ð·Ñƒ -->
            <BoxView HeightRequest="20" Color="Transparent" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
