<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.ProductSelectPage"
             x:Name="Root"
             Title="Каталог товаров">
  <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="0">
    <!-- Поиск -->
    <Border Grid.Row="0" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
        <Entry Grid.Column="0" Placeholder="🔍 Поиск товаров..." Text="{Binding Query}" HeightRequest="48" FontSize="16"/>
        <Button Grid.Column="1" Text="Поиск" Command="{Binding SearchAsyncCommand}" HeightRequest="48" WidthRequest="120"/>
      </Grid>
    </Border>

    <!-- Категории -->
    <Border Grid.Row="1" BackgroundColor="{DynamicResource Color.Surface.Alt}" Padding="16,12" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
        <HorizontalStackLayout x:Name="CategoriesStack" Spacing="8" />
      </ScrollView>
    </Border>

    <!-- Заголовок -->
    <Border Grid.Row="2" BackgroundColor="{DynamicResource Color.Surface}" Padding="16,12" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <Label Text="Выберите товар" FontSize="20" FontAttributes="Bold"/>
    </Border>

    <!-- Товары Grid -->
    <ScrollView Grid.Row="3">
      <CollectionView ItemsSource="{Binding Results}" Margin="16">
        <CollectionView.ItemsLayout>
          <GridItemsLayout Orientation="Vertical" Span="3" HorizontalItemSpacing="16" VerticalItemSpacing="16"/>
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Border StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="0" StrokeShape="RoundRectangle 8">
              <Grid RowDefinitions="*,Auto" RowSpacing="0">
                <!-- Контент -->
                <VerticalStackLayout Padding="16" Spacing="8">
                  <Label Text="{Binding Name}" FontSize="18" FontAttributes="Bold" LineBreakMode="WordWrap" MaxLines="2"/>
                  <Label Text="{Binding Sku}" FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Text="{Binding Price, StringFormat='{0:N0} сум'}" FontSize="22" FontAttributes="Bold" TextColor="{DynamicResource Color.Primary}" Margin="0,8,0,0"/>
                  
                  <!-- Остатки -->
                  <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" Margin="0,8,0,0">
                    <Label Grid.Column="0" Text="📦" FontSize="16"/>
                    <Label Grid.Column="1" Text="{Binding TotalQty, StringFormat='В наличии: {0:N0} шт'}" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}" VerticalTextAlignment="Center"/>
                  </Grid>
                </VerticalStackLayout>

                <!-- Кнопка выбора -->
                <Button Grid.Row="1" Text="Добавить" CommandParameter="{Binding .}" Clicked="OnPickClicked" HeightRequest="48" FontSize="16" FontAttributes="Bold"/>
              </Grid>
            </Border>
          </DataTemplate>
        </CollectionView.ItemTemplate>
        <CollectionView.EmptyView>
          <VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center" VerticalOptions="Center">
            <Label Text="🔍" FontSize="48" HorizontalTextAlignment="Center"/>
            <Label Text="Товары не найдены" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
            <Label Text="Попробуйте изменить запрос или выбрать другую категорию" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}" HorizontalTextAlignment="Center"/>
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>
    </ScrollView>
  </Grid>
</ContentPage>


