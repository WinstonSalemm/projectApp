<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.ProductSelectPage"
             x:Name="Root"
             Title="ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²">
  <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="0">
    <!-- ÐŸÐ¾Ð¸ÑÐº -->
    <Border Grid.Row="0" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
        <Entry Grid.Column="0" Placeholder="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²..." Text="{Binding Query}" HeightRequest="48" FontSize="16"/>
        <Button Grid.Column="1" Text="ÐŸÐ¾Ð¸ÑÐº" Command="{Binding SearchAsyncCommand}" HeightRequest="48" WidthRequest="120"/>
      </Grid>
    </Border>

    <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
    <Border Grid.Row="1" BackgroundColor="{DynamicResource Color.Surface.Alt}" Padding="16,12" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
        <HorizontalStackLayout x:Name="CategoriesStack" Spacing="8" />
      </ScrollView>
    </Border>

    <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
    <Border Grid.Row="2" BackgroundColor="{DynamicResource Color.Surface}" Padding="16,12" StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <Label Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€" FontSize="20" FontAttributes="Bold"/>
    </Border>

    <!-- Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Grid -->
    <ScrollView Grid.Row="3">
      <CollectionView ItemsSource="{Binding Results}" Margin="16">
        <CollectionView.ItemsLayout>
          <GridItemsLayout Orientation="Vertical" Span="3" HorizontalItemSpacing="16" VerticalItemSpacing="16"/>
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Border StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="0" StrokeShape="RoundRectangle 8">
              <Grid RowDefinitions="*,Auto" RowSpacing="0">
                <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
                <VerticalStackLayout Padding="16" Spacing="8">
                  <Label Text="{Binding Name}" FontSize="18" FontAttributes="Bold" LineBreakMode="WordWrap" MaxLines="2"/>
                  <Label Text="{Binding Sku}" FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Text="{Binding Price, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="22" FontAttributes="Bold" TextColor="{DynamicResource Color.Primary}" Margin="0,8,0,0"/>
                  
                  <!-- ÐžÑÑ‚Ð°Ñ‚ÐºÐ¸ -->
                  <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8" Margin="0,8,0,0">
                    <Label Grid.Column="0" Text="ðŸ“¦" FontSize="16"/>
                    <Label Grid.Column="1" Text="{Binding TotalQty, StringFormat='Ð’ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸: {0:N0} ÑˆÑ‚'}" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}" VerticalTextAlignment="Center"/>
                  </Grid>
                </VerticalStackLayout>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð²Ñ‹Ð±Ð¾Ñ€Ð° -->
                <Button Grid.Row="1" Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ" CommandParameter="{Binding .}" Clicked="OnPickClicked" HeightRequest="48" FontSize="16" FontAttributes="Bold"/>
              </Grid>
            </Border>
          </DataTemplate>
        </CollectionView.ItemTemplate>
        <CollectionView.EmptyView>
          <VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center" VerticalOptions="Center">
            <Label Text="ðŸ”" FontSize="48" HorizontalTextAlignment="Center"/>
            <Label Text="Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹" FontSize="20" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
            <Label Text="ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ÑƒÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}" HorizontalTextAlignment="Center"/>
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>
    </ScrollView>
  </Grid>
</ContentPage>


