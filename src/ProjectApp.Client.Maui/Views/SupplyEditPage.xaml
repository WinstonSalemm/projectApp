<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:services="clr-namespace:ProjectApp.Client.Maui.Services"
             x:Class="ProjectApp.Client.Maui.Views.SupplyEditPage"
             Title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"
             x:DataType="{x:Null}"
             BackgroundColor="#0F1320">

  <!-- ===== DARK THEME ===== -->
  <ContentPage.Resources>
    <ResourceDictionary>
      <Color x:Key="Bg">#0F1320</Color>
      <Color x:Key="Card">#121A2A</Color>
      <Color x:Key="Ink">#E5E7EB</Color>
      <Color x:Key="InkMuted">#9CA3AF</Color>
      <Color x:Key="Stroke">#1F2A44</Color>
      <Color x:Key="Brand">#356AE6</Color>

      <Style TargetType="Frame">
        <Setter Property="BackgroundColor" Value="{StaticResource Card}"/>
        <Setter Property="BorderColor" Value="{StaticResource Stroke}"/>
        <Setter Property="CornerRadius" Value="12"/>
        <Setter Property="Padding" Value="12"/>
      </Style>

      <Style x:Key="H1" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="FontAttributes" Value="Bold"/>
      </Style>

      <Style x:Key="H2" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontSize" Value="16"/>
        <Setter Property="FontAttributes" Value="Bold"/>
      </Style>

      <Style x:Key="P" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontSize" Value="13"/>
      </Style>

      <Style x:Key="Pmuted" TargetType="Label" BasedOn="{StaticResource P}">
        <Setter Property="TextColor" Value="{StaticResource InkMuted}"/>
      </Style>

      <Style x:Key="FieldEntry" TargetType="Entry">
        <Setter Property="Keyboard" Value="Numeric"/>
        <Setter Property="FontSize" Value="14"/>
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="BackgroundColor" Value="#0C1220"/>
        <Setter Property="HeightRequest" Value="40"/>
        <Setter Property="HorizontalTextAlignment" Value="End"/>
      </Style>

      <Style x:Key="TableHeader" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontAttributes" Value="Bold"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="Padding" Value="6,4"/>
        <Setter Property="VerticalTextAlignment" Value="Center"/>
        <Setter Property="LineBreakMode" Value="TailTruncation"/>
      </Style>

      <Style x:Key="TableHint" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="Padding" Value="6,2"/>
        <Setter Property="VerticalTextAlignment" Value="Center"/>
        <Setter Property="LineBreakMode" Value="WordWrap"/>
      </Style>

      <Style x:Key="Cell" TargetType="Label">
        <Setter Property="TextColor" Value="{StaticResource Ink}"/>
        <Setter Property="FontSize" Value="12"/>
        <Setter Property="Padding" Value="6,4"/>
        <Setter Property="VerticalTextAlignment" Value="Center"/>
      </Style>

      <Style x:Key="CellNum" TargetType="Label" BasedOn="{StaticResource Cell}">
        <Setter Property="HorizontalTextAlignment" Value="End"/>
      </Style>

      <Style x:Key="CellBorder" TargetType="Border">
        <Setter Property="Stroke" Value="{StaticResource Stroke}"/>
        <Setter Property="StrokeThickness" Value="1"/>
      </Style>
    </ResourceDictionary>
  </ContentPage.Resources>

  <!-- ===== TOOLBAR ===== -->
  <ContentPage.ToolbarItems>
    <ToolbarItem Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€" Clicked="OnAddProductClicked"/>
    <ToolbarItem Text="ÐŸÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ" Clicked="OnRecalculateClicked"/>
  </ContentPage.ToolbarItems>

  <!-- ===== PAGE ===== -->
  <ScrollView>
    <VerticalStackLayout Padding="12" Spacing="12">

      <!-- Ð¨Ð°Ð¿ÐºÐ° -->
      <Frame Padding="14" BackgroundColor="{StaticResource Brand}" BorderColor="{StaticResource Brand}">
        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto">
          <Label Grid.Row="0" Grid.Column="0" Style="{StaticResource H1}"
                 Text="{Binding Supply.Code, StringFormat='ÐŸÐ¾ÑÑ‚Ð°Ð²ÐºÐ°: {0}', FallbackValue='ÐŸÐ¾ÑÑ‚Ð°Ð²ÐºÐ°: â€¦'}"/>
          <Label Grid.Row="1" Grid.ColumnSpan="2" Style="{StaticResource P}"
                 Text="{Binding Supply.RegisterType, StringFormat='Ð ÐµÐ³Ð¸ÑÑ‚Ñ€: {0}', FallbackValue='Ð ÐµÐ³Ð¸ÑÑ‚Ñ€: â€¦'}"/>
        </Grid>
      </Frame>

      <!-- Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ -->
      <Label Style="{StaticResource H2}" Text="Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð² Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐµ"/>
      <Frame>
        <CollectionView ItemsSource="{Binding SupplyItems}" SelectionMode="None" HeightRequest="220">
          <CollectionView.EmptyView>
            <Label Text="ÐÐµÑ‚ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð². ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Â«Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Â»."
                   TextColor="{StaticResource InkMuted}"
                   HorizontalTextAlignment="Center" Margin="0,8"/>
          </CollectionView.EmptyView>
          <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="services:SupplyItemDto">
              <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto" ColumnSpacing="8" Padding="6">
                <Label Grid.Row="0" Grid.Column="0" Style="{StaticResource P}" FontAttributes="Bold" FontSize="15" Text="{Binding Name}"/>
                <Button Grid.Row="0" Grid.Column="1" Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ" BackgroundColor="#EF4444" TextColor="White"
                        WidthRequest="84" HeightRequest="36" CornerRadius="10"
                        Clicked="OnRemoveProductClicked" CommandParameter="{Binding .}"/>
                <Grid Grid.Row="1" Grid.ColumnSpan="2" ColumnDefinitions="*,*,*" ColumnSpacing="8">
                  <Label Grid.Column="0" Style="{StaticResource Pmuted}" Text="{Binding Sku, StringFormat='SKU: {0}'}"/>
                  <Label Grid.Column="1" Style="{StaticResource Pmuted}" Text="{Binding Quantity, StringFormat='ÐšÐ¾Ð»-Ð²Ð¾: {0}'}"/>
                  <Label Grid.Column="2" Style="{StaticResource Pmuted}" Text="{Binding PriceRub, StringFormat='Ð¦ÐµÐ½Ð°: {0:F2} â‚½'}"/>
                </Grid>
              </Grid>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>
      </Frame>

      <!-- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸Ð· Excel -->
      <Frame>
        <VerticalStackLayout Spacing="10">
          <Label Style="{StaticResource H2}" Text="ðŸ’° Ð ÐÐ¡Ð§ÐÐ¢ Ð¡Ð•Ð‘Ð•Ð¡Ð¢ÐžÐ˜ÐœÐžÐ¡Ð¢Ð˜"/>
          <Grid ColumnDefinitions="*,*,*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="10" RowSpacing="10">
            <!-- ÑÑ‚Ñ€Ð¾ÐºÐ° 1 -->
            <Grid>
              <Label Style="{StaticResource Pmuted}" Text="ÐšÑƒÑ€Ñ (Ð»ÑŽÐ±Ð¾Ð¹ â†’ UZS)"/>
              <Entry x:Name="AnyFxEntry" Style="{StaticResource FieldEntry}" Placeholder="149.41 / 12800"/>
            </Grid>
            <Grid Grid.Column="1">
              <Label Style="{StaticResource Pmuted}" Text="Ð¢Ð°Ð¼Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ±Ð¾Ñ€ 10 (UZS, Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸)"/>
              <Entry x:Name="CustomsFee10Entry" Style="{StaticResource FieldEntry}" Placeholder="1 030 000"/>
            </Grid>
            <Grid Grid.Column="2">
              <Label Style="{StaticResource Pmuted}" Text="Ð”Ð¾Ð¿. ÑÐ±Ð¾Ñ€ 12 (UZS, Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸)"/>
              <Entry x:Name="ExtraFee12Entry" Style="{StaticResource FieldEntry}" Placeholder="0"/>
            </Grid>
            <Grid Grid.Column="3">
              <Label Style="{StaticResource Pmuted}" Text="ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ° (UZS, Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸)"/>
              <Entry x:Name="LoadingPartyEntry" Style="{StaticResource FieldEntry}" Placeholder="0"/>
            </Grid>
            <Grid Grid.Column="4">
              <Label Style="{StaticResource Pmuted}" Text="ÐÐ°Ñ†ÐµÐ½ÐºÐ° (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding TradeMarkupPct, Mode=TwoWay}" Placeholder="0.15"/>
            </Grid>

            <!-- ÑÑ‚Ñ€Ð¾ÐºÐ° 2 (Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ñ‹ Ð¾Ñ‚ Ð±Ð°Ð·Ñ‹) -->
            <Grid Grid.Row="1">
              <Label Style="{StaticResource Pmuted}" Text="Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ° (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding LogisticsPct, Mode=TwoWay}" Placeholder="0.05"/>
            </Grid>
            <Grid Grid.Row="1" Grid.Column="1">
              <Label Style="{StaticResource Pmuted}" Text="Ð¡ÐºÐ»Ð°Ð´ (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding WarehousePct, Mode=TwoWay}" Placeholder="0.0025"/>
            </Grid>
            <Grid Grid.Row="1" Grid.Column="2">
              <Label Style="{StaticResource Pmuted}" Text="Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding DeclarationPct, Mode=TwoWay}" Placeholder="0.0094"/>
            </Grid>
            <Grid Grid.Row="1" Grid.Column="3">
              <Label Style="{StaticResource Pmuted}" Text="Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding CertificationPct, Mode=TwoWay}" Placeholder="0.0113"/>
            </Grid>
            <Grid Grid.Row="1" Grid.Column="4">
              <Label Style="{StaticResource Pmuted}" Text="ÐœÐ§Ð¡ (Ð´Ð¾Ð»Ñ)"/>
              <Entry Style="{StaticResource FieldEntry}" Text="{Binding McsPct, Mode=TwoWay}" Placeholder="0.01"/>
            </Grid>
          </Grid>

          <Button Text="ÐŸÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ" Clicked="OnRecalculateClicked"
                  BackgroundColor="#1D4ED8" TextColor="White" HeightRequest="44" CornerRadius="10"/>

          <Label Style="{StaticResource Pmuted}"
                 Text="ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ: Â«Ð¡Ð±Ð¾Ñ€ 10Â», Â«Ð”Ð¾Ð¿. ÑÐ±Ð¾Ñ€ 12Â» Ð¸ Â«ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ° (Ð¿Ð°Ñ€Ñ‚Ð¸Ñ)Â» â€” Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ñ‹ Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸, Ñ€Ð°Ð²Ð½Ð¾Ð¼ÐµÑ€Ð½Ð¾ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ÑÑ Ð½Ð° ÑˆÑ‚. ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ â€” Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ñ‹ Ð¾Ñ‚ Ð‘ÐÐ—Ð«."/>
        </VerticalStackLayout>
      </Frame>

      <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°: Ð¾Ð´Ð¸Ð½ ÑÐ¿Ð¸ÑÐ¾Ðº Ð½Ð° VM.Rows -->
      <ContentView x:Name="CostingSection">
        <ContentView.Content>
          <VerticalStackLayout Spacing="10"
                               BindingContext="{Binding Source={x:Reference CostingSection}, Path=BindingContext}">
            <Frame Padding="0">
              <ScrollView x:Name="TableScroll" Orientation="Horizontal" HorizontalScrollBarVisibility="Always" VerticalScrollBarVisibility="Never">
                <Grid MinimumWidthRequest="2200" WidthRequest="2200" HorizontalOptions="Start" BackgroundColor="{StaticResource Card}">
                  <Grid RowDefinitions="Auto,Auto,Auto,*,Auto"
                        ColumnDefinitions="40,240,90,110,110,110,110,110,110,110,110,110,120,140"
                        ColumnSpacing="0">
                    <!-- Ð“Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ -->
                    <Grid Grid.Row="0" ColumnSpacing="0">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="240"/>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="140"/>
                      </Grid.ColumnDefinitions>
                      <Border Grid.Column="3" BackgroundColor="#2C2F3F" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð‘Ð°Ð·Ð°"/></Border>
                      <Border Grid.Column="4" Grid.ColumnSpan="2" BackgroundColor="#3A2430" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐÐ±ÑÐ¾Ð»ÑŽÑ‚Ñ‹ Ð½Ð° ÑˆÑ‚"/></Border>
                      <Border Grid.Column="6" Grid.ColumnSpan="6" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚Ñ‹ Ð¾Ñ‚ Ð±Ð°Ð·Ñ‹"/></Border>
                      <Border Grid.Column="12" BackgroundColor="#12331F" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð¡ÐµÐ±ÐµÑ/ÑˆÑ‚"/></Border>
                      <Border Grid.Column="13" BackgroundColor="#2B2B2B" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð˜Ñ‚Ð¾Ð³Ð¾"/></Border>
                    </Grid>

                    <!-- ÐŸÐ¾ÑÑÐ½ÐµÐ½Ð¸Ñ Ðº ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼ -->
                    <Grid Grid.Row="1" ColumnSpacing="0" BackgroundColor="{StaticResource Card}">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="240"/>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="140"/>
                      </Grid.ColumnDefinitions>
                      <Border Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="â„–"/></Border>
                      <Border Grid.Column="1" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ / SKU"/></Border>
                      <Border Grid.Column="2" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="ÐšÐ¾Ð»-Ð²Ð¾, ÑˆÑ‚" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="3" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð‘Ð°Ð·Ð° â€” Ð·Ð°ÐºÑƒÐ¿ÐºÐ° (UZS/ÑˆÑ‚)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="4" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð¡Ð±Ð¾Ñ€ 10: Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸ â†’ Ð½Ð° ÑˆÑ‚" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="5" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ°: Ð¿Ð¾ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸ â†’ Ð½Ð° ÑˆÑ‚" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="6" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ°: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="7" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð¡ÐºÐ»Ð°Ð´: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="8" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="9" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="10" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="ÐœÐ§Ð¡: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="11" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ðµ: % Ð¾Ñ‚ Ð‘ÐÐ—Ð«" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="12" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð¡ÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð·Ð° ÑˆÑ‚" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="13" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHint}" Text="Ð˜Ñ‚Ð¾Ð³Ð¾ = ÑÐµÐ±ÐµÑ Ã— ÐºÐ¾Ð»-Ð²Ð¾" HorizontalTextAlignment="End"/></Border>
                    </Grid>

                    <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ ÐºÐ¾Ð»Ð¾Ð½Ð¾Ðº -->
                    <Grid Grid.Row="2" ColumnSpacing="0" BackgroundColor="{StaticResource Card}">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="240"/>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="140"/>
                      </Grid.ColumnDefinitions>
                      <Border Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="#"/></Border>
                      <Border Grid.Column="1" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ"/></Border>
                      <Border Grid.Column="2" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐšÐ¾Ð»-Ð²Ð¾" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="3" BackgroundColor="#2C2F3F" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð‘Ð°Ð·Ð° (UZS/ÑˆÑ‚)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="4" BackgroundColor="#3A2430" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð¢Ð°Ð¼Ð¾Ð¶ (UZS/ÑˆÑ‚)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="5" BackgroundColor="#3A2430" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐŸÐ¾Ð³Ñ€ÑƒÐ· (UZS/ÑˆÑ‚)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="6" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ° (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="7" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð¡ÐºÐ»Ð°Ð´ (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="8" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð”ÐµÐºÐ» (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="9" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð¡ÐµÑ€Ñ‚Ð¸Ñ„ (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="10" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐœÐ§Ð¡ (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="11" BackgroundColor="#1C2A46" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="ÐžÑ‚ÐºÐ» (Ð´Ð¾Ð»Ñ)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="12" BackgroundColor="#12331F" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð¡ÐµÐ±ÐµÑ/ÑˆÑ‚ (UZS/ÑˆÑ‚)" HorizontalTextAlignment="End"/></Border>
                      <Border Grid.Column="13" BackgroundColor="#2B2B2B" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð˜Ñ‚Ð¾Ð³Ð¾ (UZS, Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ)" HorizontalTextAlignment="End"/></Border>
                    </Grid>

                    <!-- Ð”Ð°Ð½Ð½Ñ‹Ðµ -->
                    <CollectionView Grid.Row="3" ItemsSource="{Binding Rows}" SelectionMode="None" HeightRequest="260" ItemSizingStrategy="MeasureAllItems" WidthRequest="2200" HorizontalOptions="Start" BackgroundColor="{StaticResource Card}">
                      <CollectionView.ItemTemplate>
                        <DataTemplate>
                          <Grid ColumnSpacing="0" WidthRequest="2200" HorizontalOptions="Start" HeightRequest="38" BackgroundColor="{StaticResource Card}">
                            <Grid.ColumnDefinitions>
                              <ColumnDefinition Width="40"/>
                              <ColumnDefinition Width="240"/>
                              <ColumnDefinition Width="90"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="110"/>
                              <ColumnDefinition Width="120"/>
                              <ColumnDefinition Width="140"/>
                            </Grid.ColumnDefinitions>
                            <Border Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding RowNo}"/></Border>
                            <Border Grid.Column="1" Style="{StaticResource CellBorder}"><Label Style="{StaticResource Cell}" Text="{Binding SkuOrName}"/></Border>
                            <Border Grid.Column="2" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding Quantity, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="3" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding BasePriceUzs, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="4" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding CustomsUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="5" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding LoadingUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="6" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding LogisticsUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="7" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding WarehouseUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="8" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding DeclarationUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="9" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding CertificationUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="10" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding McsUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="11" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding DeviationUzsPerUnit, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="12" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding CostPerUnitUzs, StringFormat='{0:N2}'}"/></Border>
                            <Border Grid.Column="13" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding LineCostUzs, StringFormat='{0:N2}'}"/></Border>
                          </Grid>
                        </DataTemplate>
                      </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Ð˜Ñ‚Ð¾Ð³Ð¸ -->
                    <Grid Grid.Row="4" ColumnSpacing="0" BackgroundColor="{StaticResource Card}">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="240"/>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="110"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="140"/>
                      </Grid.ColumnDefinitions>
                      <Border Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Î£"/></Border>
                      <Border Grid.Column="1" Style="{StaticResource CellBorder}"><Label Style="{StaticResource TableHeader}" Text="Ð˜Ñ‚Ð¾Ð³Ð¸"/></Border>
                      <Border Grid.Column="2" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalQty, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="3" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalBaseSumUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="4" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalCustomsUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="5" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalLoadingUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="6" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalLogisticsUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="7" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalWarehouseUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="8" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalDeclarationUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="9" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalCertificationUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="10" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalMcsUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="11" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalDeviationUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="12" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding WeightedCostPerUnitUzs, StringFormat='{0:N2}'}"/></Border>
                      <Border Grid.Column="13" Style="{StaticResource CellBorder}"><Label Style="{StaticResource CellNum}" Text="{Binding TotalCostUzs, StringFormat='{0:N2}'}"/></Border>
                    </Grid>
                  </Grid>
                </Grid>
              </ScrollView>
            </Frame>
          </VerticalStackLayout>
        </ContentView.Content>
      </ContentView>

      <!-- ÐÐ¸Ð· -->
      <Grid ColumnDefinitions="*,Auto,Auto">
        <Label Grid.Column="0" Style="{StaticResource Pmuted}" Text="Ð¡ÑƒÐ¼Ð¼Ñ‹ Ð¸ Ð²ÐµÑÐ° Ð±ÐµÑ€ÑƒÑ‚ÑÑ Ð¸Ð· VM. â€˜Ð¡Ð±Ð¾Ñ€ 10/12â€™ Ð¸ â€˜ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ° (Ð¿Ð°Ñ€Ñ‚Ð¸Ñ)â€™ Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ÑÑ Ð½Ð° ÑˆÑ‚. Ð¿Ð¾Ð²ÐµÑ€Ñ… VM."/>
        <Label Grid.Column="1" Style="{StaticResource P}" Text="{Binding TotalQty, StringFormat='ÐšÐ¾Ð»-Ð²Ð¾: {0:N2}'}"/>
        <Label Grid.Column="2" Style="{StaticResource P}" Text="{Binding TotalBaseSumUzs, StringFormat='Ð‘Ð°Ð·Ð°: {0:N2} UZS'}"/>
      </Grid>

    </VerticalStackLayout>
  </ScrollView>
</ContentPage>
