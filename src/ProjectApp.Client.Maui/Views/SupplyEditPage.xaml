<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             xmlns:services="clr-namespace:ProjectApp.Client.Maui.Services"
             x:Class="ProjectApp.Client.Maui.Views.SupplyEditPage"
             Title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"
             x:DataType="{x:Null}">
    <!-- ===== RESOURCES / STYLES ===== -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÑ‚Ð¸Ð»Ð¸ -->
            <Style x:Key="TableHeaderLabel"
                   TargetType="Label">
                <Setter Property="FontAttributes"
                        Value="Bold" />
                <Setter Property="FontSize"
                        Value="12" />
                <Setter Property="Padding"
                        Value="8,6" />
                <Setter Property="BackgroundColor"
                        Value="#ecf0f1" />
                <Setter Property="TextColor"
                        Value="#2c3e50" />
                <Setter Property="LineBreakMode"
                        Value="TailTruncation" />
            </Style>
            <Style x:Key="CellLabel"
                   TargetType="Label">
                <Setter Property="FontSize"
                        Value="12" />
                <Setter Property="Padding"
                        Value="8,6" />
                <Setter Property="LineBreakMode"
                        Value="TailTruncation" />
                <Setter Property="VerticalTextAlignment"
                        Value="Center" />
            </Style>
            <Style x:Key="CellMuted"
                   TargetType="Label"
                   BasedOn="{StaticResource CellLabel}">
                <Setter Property="FontSize"
                        Value="11" />
                <Setter Property="TextColor"
                        Value="Gray" />
            </Style>
            <Style x:Key="CellNum"
                   TargetType="Label"
                   BasedOn="{StaticResource CellLabel}">
                <Setter Property="HorizontalTextAlignment"
                        Value="End" />
            </Style>
            <Style x:Key="CellBorder"
                   TargetType="Border">
                <Setter Property="Stroke"
                        Value="#d1d5db" />
                <Setter Property="StrokeThickness"
                        Value="1" />
            </Style>
            <Style x:Key="FieldLabel"
                   TargetType="Label">
                <Setter Property="VerticalTextAlignment"
                        Value="Center" />
                <Setter Property="FontSize"
                        Value="13" />
            </Style>
            <Style x:Key="FieldEntry"
                   TargetType="Entry">
                <Setter Property="Keyboard"
                        Value="Numeric" />
                <Setter Property="FontSize"
                        Value="13" />
                <Setter Property="HeightRequest"
                        Value="36" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>
    <!-- ===== TOOLBAR ===== -->
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€"
                     Clicked="OnAddProductClicked"
                     IconImageSource="add.png" />
        <ToolbarItem Text="ðŸ”„ ÐŸÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ"
                     Clicked="OnRecalculateClicked" />
    </ContentPage.ToolbarItems>
    <!-- ===== PAGE ===== -->
    <ScrollView>
        <VerticalStackLayout Padding="10"
                             Spacing="10">
            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ -->
            <Frame BorderColor="LightGray"
                   CornerRadius="8"
                   Padding="12"
                   Margin="0,0,0,4">
                <Grid RowDefinitions="Auto,Auto"
                      ColumnDefinitions="*,Auto"
                      ColumnSpacing="8">
                    <Label Grid.Row="0"
                           Grid.Column="0"
                           Text="{Binding Supply.Code, StringFormat='ÐŸÐ¾ÑÑ‚Ð°Ð²ÐºÐ°: {0}', FallbackValue='ÐŸÐ¾ÑÑ‚Ð°Ð²ÐºÐ°: â€¦'}"
                           FontSize="20"
                           FontAttributes="Bold" />
                    <Label Grid.Row="1"
                           Grid.Column="0"
                           Text="{Binding Supply.RegisterType, StringFormat='Ð ÐµÐ³Ð¸ÑÑ‚Ñ€: {0}', FallbackValue='Ð ÐµÐ³Ð¸ÑÑ‚Ñ€: â€¦'}"
                           FontSize="13"
                           TextColor="Gray" />
                </Grid>
            </Frame>
            <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² -->
            <Label Text="Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ð² Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐµ:"
                   FontSize="16"
                   FontAttributes="Bold" />
            <CollectionView ItemsSource="{Binding SupplyItems}"
                            SelectionMode="None"
                            HeightRequest="240">
                <CollectionView.EmptyView>
                    <Label Text="ÐÐµÑ‚ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð². ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ '+' Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ."
                           TextColor="Gray"
                           HorizontalTextAlignment="Center"
                           Margin="0,12,0,0" />
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="services:SupplyItemDto">
                        <Frame Margin="0,6"
                               Padding="10"
                               BorderColor="LightGray">
                            <Grid RowDefinitions="Auto,Auto,Auto"
                                  ColumnDefinitions="*,Auto"
                                  ColumnSpacing="8">
                                <Label Grid.Row="0"
                                       Grid.Column="0"
                                       Text="{Binding Name}"
                                       FontSize="15"
                                       FontAttributes="Bold" />
                                <Button Grid.Row="0"
                                        Grid.Column="1"
                                        Text="ðŸ—‘ï¸"
                                        Clicked="OnRemoveProductClicked"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#e74c3c"
                                        TextColor="White"
                                        WidthRequest="36"
                                        HeightRequest="36" />
                                <Label Grid.Row="1"
                                       Grid.Column="0"
                                       Grid.ColumnSpan="2"
                                       Text="{Binding Sku, StringFormat='SKU: {0}'}"
                                       FontSize="12"
                                       TextColor="Gray" />
                                <Grid Grid.Row="2"
                                      Grid.Column="0"
                                      Grid.ColumnSpan="2"
                                      ColumnDefinitions="*,*,*"
                                      ColumnSpacing="8"
                                      Margin="0,4,0,0">
                                    <Label Grid.Column="0"
                                           Text="{Binding Quantity, StringFormat='ÐšÐ¾Ð»-Ð²Ð¾: {0}'}"
                                           FontSize="12" />
                                    <Label Grid.Column="1"
                                           Text="{Binding PriceRub, StringFormat='Ð¦ÐµÐ½Ð°: {0:F2} â‚½'}"
                                           FontSize="12" />
                                    <Label Grid.Column="2"
                                           Text="{Binding Weight, StringFormat='Ð’ÐµÑ: {0:F2} ÐºÐ³'}"
                                           FontSize="12" />
                                </Grid>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <!-- Ð¡ÐµÐºÑ†Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð° -->
            <Frame BackgroundColor="#3498db"
                   Padding="12"
                   CornerRadius="8">
                <Label Text="ðŸ’° Ð ÐÐ¡Ð§ÐÐ¢ Ð¡Ð•Ð‘Ð•Ð¡Ð¢ÐžÐ˜ÐœÐžÐ¡Ð¢Ð˜"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center" />
            </Frame>
            <Frame BorderColor="#3498db"
                   Padding="12"
                   CornerRadius="8">
                <VerticalStackLayout Spacing="10">
                    <!-- ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ (Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ + Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ‹) -->
                    <Grid ColumnDefinitions="*,*,*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="10" RowSpacing="8">

                      <Grid Grid.Row="0" Grid.Column="0" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="ÐšÑƒÑ€Ñ â‚½â†’UZS:" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding ExchangeRate, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 158,08"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="0" Grid.Column="1" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="ÐÐ”Ð¡ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding VatPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.22 = 22%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="0" Grid.Column="2" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ° (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding LogisticsPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.05 = 5%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="0" Grid.Column="3" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="Ð¡ÐºÐ»Ð°Ð´ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding WarehousePct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.005 = 0.5%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="0" Grid.Column="4" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding DeclarationPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.002 = 0.2%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="1" Grid.Column="0" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding CertificationPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.01 = 1%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="1" Grid.Column="1" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="ÐœÐ§Ð¡ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding MchsPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.01 = 1%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="1" Grid.Column="2" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ñ (%):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding DeviationPct, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="0.015 = 1.5%"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="1" Grid.Column="3" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="Ð¢Ð°Ð¼Ð¾Ð¶Ð½Ñ (UZS):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding CustomsTotalAbs, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 1 030 000"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                      <Grid Grid.Row="1" Grid.Column="4" ColumnDefinitions="Auto,*" ColumnSpacing="6">
                        <Label Grid.Column="0" Text="ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ° (UZS):" VerticalTextAlignment="Center" FontSize="12" TextColor="Gray"/>
                        <Entry Grid.Column="1"
                               Text="{Binding LoadingTotalAbs, Mode=TwoWay}"
                               Keyboard="Numeric"
                               Placeholder="Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 1 000 000"
                               TextChanged="OnInlineNumberChanged"/>
                      </Grid>

                    </Grid>
                    <BoxView HeightRequest="1"
                             Color="#e5e7eb"
                             Margin="0,2,0,0" />
                    <!-- Ð˜Ð½Ñ„Ð¾ Ð¸ Ð¸Ñ‚Ð¾Ð³ -->
                    <Grid ColumnDefinitions="*,Auto"
                          Margin="0,-2,0,0">
                        <Label Grid.Column="0"
                               Text="Ð¢Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð² Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ðµ:"
                               FontSize="14" />
                        <Label Grid.Column="1"
                               Text="{Binding CostItemsCount}"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="#2980b9" />
                    </Grid>
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Grid.Column="0"
                               Text="Ð˜Ð¢ÐžÐ“Ðž Ð¡Ð•Ð‘Ð•Ð¡Ð¢ÐžÐ˜ÐœÐžÐ¡Ð¢Ð¬:"
                               FontSize="18"
                               FontAttributes="Bold" />
                        <Label Grid.Column="1"
                               Text="{Binding TotalCost, StringFormat='{0:N0} UZS'}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#e74c3c" />
                    </Grid>
                    <Label Text="Ð”ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°:"
                           FontAttributes="Bold"
                           FontSize="16" />
                    <!-- ===== Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° (Ñ€ÐµÐ·Ð¸Ð½Ð¾Ð²Ð°Ñ ÑˆÐ¸Ñ€Ð¸Ð½Ð°) ===== -->
                    <ScrollView Orientation="Both"
                                HeightRequest="260"
                                HorizontalScrollBarVisibility="Always"
                                VerticalScrollBarVisibility="Always">
                        <Grid>
                            <Grid x:Name="CostTableHost"
                                  WidthRequest="{OnIdiom Phone=1100, Tablet=1400, Desktop=1600}"
                                  RowDefinitions="Auto,*">
                                <!-- Ð¨Ð°Ð¿ÐºÐ° -->
                                <Grid Grid.Row="0"
                                      ColumnDefinitions="40,300,120,90,140,140,140,140,140,140,140,140,180"
                                      ColumnSpacing="0"
                                      RowSpacing="0">
                                    <Border Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="#" />
                                    </Border>
                                    <Border Grid.Column="1"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ð½Ð°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ" />
                                    </Border>
                                    <Border Grid.Column="2"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ñ†ÐµÐ½Ð° â‚½"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="3"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="ÐºÑƒÑ€Ñ"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="4"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ñ†ÐµÐ½Ð° Ð² ÑÑƒÐ¼Ð°Ñ…"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="5"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ñ‚Ð°Ð¼Ð¾Ð¶Ð½Ñ"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="6"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ð½Ð´Ñ"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="7"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ð»Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ°"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="8"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="ÑÐºÐ»Ð°Ð´"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="9"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ð´ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="10"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="11"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="Ð¿Ñ€Ð¾Ñ‡Ð¸Ðµ / Ð¿Ð¾Ð³Ñ€ÑƒÐ·ÐºÐ°"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                    <Border Grid.Column="12"
                                            Style="{StaticResource CellBorder}">
                                        <Label Style="{StaticResource TableHeaderLabel}"
                                               Text="ÑÐµÐ±ÐµÑ / Ð¸Ñ‚Ð¾Ð³Ð¾"
                                               HorizontalTextAlignment="End" />
                                    </Border>
                                </Grid>
                                <!-- Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸ -->
                                <CollectionView Grid.Row="1"
                                                ItemsSource="{Binding CostItems}"
                                                SelectionMode="None">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="{x:Null}">
                                            <Grid ColumnDefinitions="40,300,120,90,140,140,140,140,140,140,140,140,180"
                                                  ColumnSpacing="0"
                                                  RowSpacing="0">
                                                <!-- # -->
                                                <Border Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}"
                                                           Text="{Binding RowNumber}" />
                                                </Border>
                                                <!-- Ð¢Ð¾Ð²Ð°Ñ€ + ÐºÐ¾Ð»-Ð²Ð¾ -->
                                                <Border Grid.Column="1"
                                                        Style="{StaticResource CellBorder}">
                                                    <VerticalStackLayout Spacing="2"
                                                                         Padding="8,6">
                                                        <Label Text="{Binding ProductName}"
                                                               FontAttributes="Bold"
                                                               FontSize="13" />
                                                        <Label Style="{StaticResource CellMuted}"
                                                               Text="{Binding Quantity, StringFormat='ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾: {0}'}" />
                                                    </VerticalStackLayout>
                                                </Border>
                                                <!-- Ð¦ÐµÐ½Ð° â‚½ -->
                                                <Border Grid.Column="2"
                                                        Style="{StaticResource CellBorder}">
                                                    <Entry Text="{Binding PriceRub, Mode=TwoWay, StringFormat='{}{0:F2}'}"
                                                       x:Name="PriceRubEntry"
                                                       TextChanged="OnPriceRubChanged"
                                                       Keyboard="Numeric"
                                                       HorizontalTextAlignment="End"
                                                       FontSize="12"
                                                       WidthRequest="120" />
                                                </Border>
                                                <!-- ÐšÑƒÑ€Ñ -->
                                                <Border Grid.Column="3"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}"
                                                           Text="{Binding ExchangeRate, StringFormat='{0:F2}'}" />
                                                </Border>
                                                <!-- Ð¦ÐµÐ½Ð° UZS -->
                                                <Border Grid.Column="4"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}"
                                                           Text="{Binding PriceUzs, StringFormat='{0:N0}'}" />
                                                </Border>
                                                <!-- Ð¢Ð°Ð¼Ð¾Ð¶Ð½Ñ -->
                                                <Border Grid.Column="5"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}"
                                                           Text="{Binding CustomsUzs, StringFormat='{0:N0}'}" />
                                                </Border>
                                                <!-- ÐÐ”Ð¡ -->
                                                <Border Grid.Column="6"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}"
                                                           Text="{Binding VatUzs, StringFormat='{0:N0}'}" />
                                                </Border>
                                                <!-- Ð›Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                                                <Border Grid.Column="7"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding LogisticsUzs, StringFormat='{}{0:N0}'}" />
                                                                <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.LogisticsPct, StringFormat=' ({0:P1})'}"
                                                                      FontSize="11"
                                                                      TextColor="Gray" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </Border>
                                                <!-- Ð¡ÐºÐ»Ð°Ð´ -->
                                                <Border Grid.Column="8"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding StorageUzs, StringFormat='{}{0:N0}'}" />
                                                                <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.WarehousePct, StringFormat=' ({0:P1})'}"
                                                                      FontSize="11"
                                                                      TextColor="Gray" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </Border>
                                                <!-- Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ -->
                                                <Border Grid.Column="9"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding DeclarationUzs, StringFormat='{}{0:N0}'}" />
                                                                <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeclarationPct, StringFormat=' ({0:P1})'}"
                                                                      FontSize="11"
                                                                      TextColor="Gray" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </Border>
                                                <!-- Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ -->
                                                <Border Grid.Column="10"
                                                        Style="{StaticResource CellBorder}">
                                                    <Label Style="{StaticResource CellNum}">
                                                        <Label.FormattedText>
                                                            <FormattedString>
                                                                <Span Text="{Binding CertificationUzs, StringFormat='{}{0:N0}'}" />
                                                                <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.CertificationPct, StringFormat=' ({0:P1})'}"
                                                                      FontSize="11"
                                                                      TextColor="Gray" />
                                                            </FormattedString>
                                                        </Label.FormattedText>
                                                    </Label>
                                                </Border>
                                                <!-- ÐŸÑ€Ð¾Ñ‡Ð¸Ðµ / ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ° + ÐœÐ§Ð¡ + ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¸Ñ -->
                                                <Border Grid.Column="11"
                                                        Style="{StaticResource CellBorder}">
                                                    <VerticalStackLayout Spacing="2"
                                                                         Padding="8,6">
                                                        <Label HorizontalTextAlignment="End">
                                                            <Label.FormattedText>
                                                                <FormattedString>
                                                                    <Span Text="ÐœÐ§Ð¡: " />
                                                                    <Span Text="{Binding MChsUzs, StringFormat='{}{0:N0}'}" />
                                                                    <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.MchsPct, StringFormat=' ({0:P1})'}"
                                                                          FontSize="11"
                                                                          TextColor="Gray" />
                                                                </FormattedString>
                                                            </Label.FormattedText>
                                                        </Label>
                                                        <Label HorizontalTextAlignment="End">
                                                            <Label.FormattedText>
                                                                <FormattedString>
                                                                    <Span Text="ÐžÑ‚ÐºÐ»: " />
                                                                    <Span Text="{Binding UnforeseenUzs, StringFormat='{}{0:N0}'}" />
                                                                    <Span Text="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeviationPct, StringFormat=' ({0:P1})'}"
                                                                          FontSize="11"
                                                                          TextColor="Gray" />
                                                                </FormattedString>
                                                            </Label.FormattedText>
                                                        </Label>
                                                        <Label HorizontalTextAlignment="End">
                                                            <Label.FormattedText>
                                                                <FormattedString>
                                                                    <Span Text="ÐŸÐ¾Ð³Ñ€ÑƒÐ·ÐºÐ°: " />
                                                                    <Span Text="{Binding LoadingUzs, StringFormat='{}{0:N0}'}" />
                                                                </FormattedString>
                                                            </Label.FormattedText>
                                                        </Label>
                                                    </VerticalStackLayout>
                                                </Border>
                                                <!-- Ð¡ÐµÐ±ÐµÑ / Ð¸Ñ‚Ð¾Ð³Ð¾ -->
                                                <Border Grid.Column="12"
                                                        Style="{StaticResource CellBorder}">
                                                    <VerticalStackLayout Spacing="2"
                                                                         Padding="8,6">
                                                        <Label Style="{StaticResource CellNum}"
                                                               FontAttributes="Bold"
                                                               Text="{Binding UnitCostUzs, StringFormat='{0:N0} UZS'}" />
                                                        <Label HorizontalTextAlignment="End"
                                                               Style="{StaticResource CellMuted}">
                                                            <Label.FormattedText>
                                                                <FormattedString>
                                                                    <Span Text="Ã— " />
                                                                    <Span Text="{Binding Quantity}" />
                                                                </FormattedString>
                                                            </Label.FormattedText>
                                                        </Label>
                                                        <Label HorizontalTextAlignment="End"
                                                               FontAttributes="Bold"
                                                               TextColor="#27ae60">
                                                            <Label.FormattedText>
                                                                <FormattedString>
                                                                    <Span Text="= " />
                                                                    <Span Text="{Binding TotalCostUzs, StringFormat='{}{0:N0} UZS'}" />
                                                                </FormattedString>
                                                            </Label.FormattedText>
                                                        </Label>
                                                    </VerticalStackLayout>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </Grid>
                        </Grid>
                    </ScrollView>
                    <BoxView HeightRequest="1"
                             Color="#e5e7eb"
                             Margin="0,4,0,0" />
                    <Label Text="Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹: Ð¦ÐµÐ½Ð° UZS = Ð¦ÐµÐ½Ð° â‚½ Ã— ÐšÑƒÑ€Ñ. ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚Ð½Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑŒÐ¸ ÑÑ‡Ð¸Ñ‚Ð°ÑŽÑ‚ÑÑ Ð¾Ñ‚ Ñ†ÐµÐ½Ñ‹ Ð² UZS. Ð¢Ð°Ð¼Ð¾Ð¶Ð½Ñ Ð¸ Ð¿Ð¾Ð³Ñ€ÑƒÐ·ÐºÐ° â€” Ñ„Ð¸ÐºÑ. ÑÑƒÐ¼Ð¼Ñ‹, Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÑŽÑ‚ÑÑ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ."
                           FontSize="12"
                           TextColor="Gray" />
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>