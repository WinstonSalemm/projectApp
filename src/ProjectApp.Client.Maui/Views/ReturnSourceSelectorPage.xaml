<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             xmlns:models="clr-namespace:ProjectApp.Client.Maui.Models"
             x:Class="ProjectApp.Client.Maui.Views.ReturnSourceSelectorPage"
             x:DataType="vm:ReturnSourceSelectorViewModel"
             Title="Ð’Ñ‹Ð±Ð¾Ñ€ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°"
             BackgroundColor="{DynamicResource Color.Background}">
  
  <Grid RowDefinitions="Auto,*">
    <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ -->
    <Border Grid.Row="0" Padding="16" BackgroundColor="{DynamicResource Color.Surface}" 
            StrokeThickness="0,0,0,1" Stroke="{DynamicResource Color.Border}">
      <VerticalStackLayout Spacing="12">
        <Label Text="ðŸ“‹ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ Ð¸Ð»Ð¸ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€ Ð´Ð»Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°" FontSize="16" FontAttributes="Bold"/>
        
        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
          <VerticalStackLayout Grid.Column="0" Spacing="4">
            <Label Text="ÐžÑ‚:" FontSize="12" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <DatePicker Date="{Binding DateFrom}" Format="dd.MM.yyyy" 
                       BackgroundColor="{DynamicResource Color.Surface}"
                       TextColor="{DynamicResource Color.Text.Primary}"/>
          </VerticalStackLayout>
          
          <VerticalStackLayout Grid.Column="1" Spacing="4">
            <Label Text="Ð”Ð¾:" FontSize="12" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <DatePicker Date="{Binding DateTo}" Format="dd.MM.yyyy"
                       BackgroundColor="{DynamicResource Color.Surface}"
                       TextColor="{DynamicResource Color.Text.Primary}"/>
          </VerticalStackLayout>
        </Grid>
        
        <Button Text="ðŸ” Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ" Command="{Binding LoadCommand}" 
                BackgroundColor="{DynamicResource Color.Primary}" 
                TextColor="White" CornerRadius="8"/>
      </VerticalStackLayout>
    </Border>

    <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ -->
    <ScrollView Grid.Row="1">
      <VerticalStackLayout Padding="16" Spacing="12">
        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <ActivityIndicator IsRunning="{Binding IsLoading}" 
                          IsVisible="{Binding IsLoading}"
                          Color="{DynamicResource Color.Primary}"
                          HeightRequest="50"/>

        <!-- ÐŸÑƒÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº -->
        <Label Text="ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ' Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹."
               IsVisible="{Binding HasNoItems}"
               HorizontalOptions="Center" Margin="0,50,0,0"
               TextColor="{DynamicResource Color.Text.Secondary}"/>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº -->
        <VerticalStackLayout BindableLayout.ItemsSource="{Binding Items}" Spacing="12">
          <BindableLayout.ItemTemplate>
            <DataTemplate x:DataType="models:ReturnSourceItem">
              <Border StrokeThickness="1" 
                      Stroke="{DynamicResource Color.Border}" 
                      BackgroundColor="{DynamicResource Color.Surface}" 
                      Padding="16" 
                      StrokeShape="RoundRectangle 12">
                <Border.GestureRecognizers>
                  <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ReturnSourceSelectorViewModel}}, Path=OpenReturnCommand}"
                                       CommandParameter="{Binding .}"/>
                </Border.GestureRecognizers>
                
                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                  <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                  <Label Grid.Row="0" Text="{Binding DisplayTitle}" 
                         FontSize="16" FontAttributes="Bold"/>
                  
                  <!-- ÐŸÐ¾Ð´Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                  <Label Grid.Row="1" Text="{Binding DisplaySubtitle}" 
                         FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  
                  <!-- Ð¢Ð¸Ð¿ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ -->
                  <Border Grid.Row="2" 
                          Padding="8,4" 
                          BackgroundColor="{DynamicResource Color.Primary}"
                          StrokeThickness="0"
                          HorizontalOptions="Start"
                          StrokeShape="RoundRectangle 4">
                    <Label Text="{Binding DisplayPaymentType}" 
                           FontSize="11" 
                           TextColor="White"
                           FontAttributes="Bold"/>
                  </Border>
                </Grid>
              </Border>
            </DataTemplate>
          </BindableLayout.ItemTemplate>
        </VerticalStackLayout>
      </VerticalStackLayout>
    </ScrollView>
  </Grid>
</ContentPage>
