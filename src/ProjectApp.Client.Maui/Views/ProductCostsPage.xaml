<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.ProductCostsPage"
             x:DataType="vm:AnalyticsViewModel"
             Title="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒÑŽ"
             BackgroundColor="{DynamicResource Color.Background}">
  
  <ScrollView Padding="16">
    <VerticalStackLayout Spacing="16">
      <Label Text="ðŸ“¦ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒÑŽ" FontSize="24" FontAttributes="Bold" Margin="0,0,0,16"/>
      
      <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ -->
      <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" Margin="0,0,0,8">
        <!-- ÐŸÐ¾Ð¸ÑÐº -->
        <Border Grid.Column="0" 
                StrokeThickness="1" 
                Stroke="{DynamicResource Color.Border}" 
                BackgroundColor="{DynamicResource Color.Surface}" 
                Padding="12,8" 
                StrokeShape="RoundRectangle 8">
          <Entry Text="{Binding SearchQuery}" 
                 Placeholder="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð¸Ð»Ð¸ SKU..." 
                 FontSize="14"
                 BackgroundColor="Transparent"
                 TextColor="{DynamicResource Color.Text.Primary}"/>
        </Border>
        
        <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ -->
        <Border Grid.Column="1" 
                StrokeThickness="1" 
                Stroke="{DynamicResource Color.Border}" 
                BackgroundColor="{DynamicResource Color.Surface}" 
                Padding="12,8" 
                StrokeShape="RoundRectangle 8"
                MinimumWidthRequest="200">
          <Picker ItemsSource="{Binding Categories}" 
                  SelectedItem="{Binding SelectedCategory}"
                  FontSize="14"
                  TextColor="{DynamicResource Color.Text.Primary}"/>
        </Border>
      </Grid>
      
      <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² -->
      <VerticalStackLayout BindableLayout.ItemsSource="{Binding ProductCosts}" Spacing="12">
        <BindableLayout.EmptyView>
          <VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center">
            <Label Text="ðŸ“¦" FontSize="48" HorizontalTextAlignment="Center"/>
            <Label Text="Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²..." FontSize="16" TextColor="{DynamicResource Color.Text.Secondary}" HorizontalTextAlignment="Center"/>
          </VerticalStackLayout>
        </BindableLayout.EmptyView>
        
        <BindableLayout.ItemTemplate>
          <DataTemplate x:DataType="vm:AnalyticsViewModel+ProductCostRow">
            <Border StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" Margin="0,0,0,12" StrokeShape="RoundRectangle 12">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                <!-- SKU Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ -->
                <VerticalStackLayout Grid.Row="0" Spacing="4">
                  <Label Text="{Binding Sku}" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Text="{Binding Name}" FontSize="18" FontAttributes="Bold"/>
                </VerticalStackLayout>
                
                <!-- Ð¢ÐµÐºÑƒÑ‰Ð°Ñ ÑÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ -->
                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                  <Label Grid.Column="0" Text="ðŸ’¸ Ð¡ÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:" FontSize="14" VerticalTextAlignment="Center"/>
                  <Entry Grid.Column="1" Text="{Binding Cost}" Keyboard="Numeric" Placeholder="0" FontSize="14"/>
                  <Button Grid.Column="2" Text="ðŸ’¾" Clicked="OnSaveCostClicked" CommandParameter="{Binding}" Padding="12,8" BackgroundColor="{DynamicResource Color.Primary}"/>
                </Grid>
                
                <!-- Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ñ†ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                  <Label Grid.Column="0" Text="ðŸ’° Ð¡Ñ€ÐµÐ´. Ñ†ÐµÐ½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸:" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Grid.Column="1" Text="{Binding AveragePrice, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="14" FontAttributes="Bold"/>
                </Grid>
                
                <!-- ÐœÐ°Ñ€Ð¶Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ -->
                <Grid Grid.Row="3" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                  <Label Grid.Column="0" Text="ðŸ“ˆ ÐœÐ°Ñ€Ð¶Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ:" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Grid.Column="1" Text="{Binding MarginPercent, StringFormat='{0:F1}%'}" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource Color.Success}"/>
                </Grid>
                
                <!-- ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒ Ñ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñ‹ -->
                <Grid Grid.Row="4" ColumnDefinitions="Auto,*" ColumnSpacing="8">
                  <Label Grid.Column="0" Text="âœ… ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒ/ÐµÐ´:" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Grid.Column="1" Text="{Binding ProfitPerUnit, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="14" FontAttributes="Bold" TextColor="{DynamicResource Color.Primary}"/>
                </Grid>
              </Grid>
            </Border>
          </DataTemplate>
        </BindableLayout.ItemTemplate>
      </VerticalStackLayout>
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>
