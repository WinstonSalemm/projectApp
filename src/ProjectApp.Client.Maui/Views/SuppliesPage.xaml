<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             xmlns:behaviors="clr-namespace:ProjectApp.Client.Maui.Behaviors"
             x:Class="ProjectApp.Client.Maui.Views.SuppliesPage"
             x:Name="Root"
             Title="РџРѕСЃС‚Р°РІРєРё (ND-40)">
  <ScrollView>
    <VerticalStackLayout Padding="24" Spacing="20">
      <!-- Supply section -->
      <Label Text="РќРѕРІР°СЏ РїРѕСЃС‚Р°РІРєР° РІ ND-40" Style="{StaticResource SectionTitle}"/>

      <!-- Step 1: pick product -->
      <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
        <Button Text="Р’С‹Р±СЂР°С‚СЊ С‚РѕРІР°СЂ" Clicked="OnPickProductForSupplyClicked" Style="{StaticResource OutlinedButton}"/>
        <VerticalStackLayout Grid.Column="1" Spacing="2">
          <Label Text="{Binding NewProductSku}" FontAttributes="Bold"/>
          <Label Text="{Binding NewProductName}" FontSize="12" TextColor="Gray"/>
        </VerticalStackLayout>
        <Button Grid.Column="2" Text="РќРѕРІС‹Р№ С‚РѕРІР°СЂ" Clicked="OnCreateProductClicked" Style="{StaticResource OutlinedButton}"/>
      </Grid>

      <!-- Step 2: qty/cost/code -->
      <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
        <VerticalStackLayout>
          <Label Text="РљРѕР»-РІРѕ" FontSize="12"/>
          <Entry Placeholder="РќР°РїСЂ. 10,5" Text="{Binding NewQty}" Keyboard="Numeric">
            <Entry.Behaviors>
              <behaviors:DecimalBehavior />
            </Entry.Behaviors>
          </Entry>
        </VerticalStackLayout>
        <VerticalStackLayout>
          <Label Text="РЎРµР±РµСЃС‚РѕРёРјРѕСЃС‚СЊ" FontSize="12"/>
          <Entry Placeholder="0" Text="{Binding NewUnitCost}" Keyboard="Numeric">
            <Entry.Behaviors>
              <behaviors:DecimalBehavior />
            </Entry.Behaviors>
          </Entry>
        </VerticalStackLayout>
        <VerticalStackLayout>
          <Label Text="РљРѕРґ (РїР°СЂС‚РёСЏ)" FontSize="12"/>
          <Entry Placeholder="РЅР°РїСЂ. A-001" Text="{Binding NewCode}"/>
        </VerticalStackLayout>
      </Grid>

      <HorizontalStackLayout Spacing="12">
        <Label Text="{Binding SelectedNd40Qty, StringFormat='ND-40: {0:N0}'}" FontSize="11"/>
        <Label Text="{Binding SelectedIm40Qty, StringFormat='IM-40: {0:N0}'}" FontSize="11"/>
        <Label Text="{Binding SelectedTotalQty, StringFormat='Р’СЃРµРіРѕ: {0:N0}'}" FontSize="11"/>
        <Label Text="{Binding NewLineTotal, StringFormat='РЎСѓРјРјР° СЃС‚СЂРѕРєРё: {0:N0}'}" FontSize="11" FontAttributes="Bold"/>
      </HorizontalStackLayout>

      <Entry Placeholder="РџСЂРёРјРµС‡Р°РЅРёРµ" Text="{Binding NewNote}"/>

      <HorizontalStackLayout Spacing="12">
        <Button Text="Р”РѕР±Р°РІРёС‚СЊ РїРѕР·РёС†РёСЋ" Command="{Binding AddItemCommand}" Style="{StaticResource OutlinedButton}"/>
        <Button Text="РЎРѕР·РґР°С‚СЊ РїРѕСЃС‚Р°РІРєСѓ" Command="{Binding CreateSupplyCommand}" Style="{StaticResource CtaPrimary}"/>
      </HorizontalStackLayout>

      <!-- Items list -->
      <CollectionView ItemsSource="{Binding Items}">
        <CollectionView.Header>
          <Grid ColumnDefinitions="Auto,*,Auto,80,100,Auto,Auto" Padding="8" ColumnSpacing="12">
            <Label Text="SKU" FontAttributes="Bold"/>
            <Label Grid.Column="1" Text="РќР°Р·РІР°РЅРёРµ" FontAttributes="Bold"/>
            <Label Grid.Column="2" Text="РљРѕРґ" FontAttributes="Bold"/>
            <Label Grid.Column="3" Text="РљРѕР»-РІРѕ" FontAttributes="Bold" HorizontalTextAlignment="End"/>
            <Label Grid.Column="4" Text="РЎРµР±РµСЃС‚РѕРёРј." FontAttributes="Bold" HorizontalTextAlignment="End"/>
            <Label Grid.Column="5" Text="РС‚РѕРіРѕ" FontAttributes="Bold" HorizontalTextAlignment="End"/>
            <Label Grid.Column="6" Text=""/>
          </Grid>
        </CollectionView.Header>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Grid ColumnDefinitions="Auto,*,Auto,80,100,Auto,Auto" ColumnSpacing="12" Padding="8">
              <Label Text="{Binding Sku}" FontAttributes="Bold"/>
              <Label Grid.Column="1" Text="{Binding Name}" LineBreakMode="TailTruncation"/>
              <Label Grid.Column="2" Text="{Binding Code}"/>
              <Entry Grid.Column="3" Text="{Binding Qty, Mode=TwoWay}" Keyboard="Numeric" HorizontalTextAlignment="End" WidthRequest="80">
                <Entry.Behaviors>
                  <behaviors:DecimalBehavior />
                </Entry.Behaviors>
              </Entry>
              <Entry Grid.Column="4" Text="{Binding UnitCost, Mode=TwoWay}" Keyboard="Numeric" HorizontalTextAlignment="End" WidthRequest="100">
                <Entry.Behaviors>
                  <behaviors:DecimalBehavior />
                </Entry.Behaviors>
              </Entry>
              <Label Grid.Column="5" Text="{Binding Total, StringFormat='{0:N0}'}" FontAttributes="Bold" HorizontalTextAlignment="End"/>
              <Button Grid.Column="6" Text="РЈРґР°Р»РёС‚СЊ" Command="{Binding Source={x:Reference Root}, Path=BindingContext.RemoveItemCommand}" CommandParameter="{Binding .}" Style="{StaticResource OutlinedButton}"/>
            </Grid>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

      <BoxView HeightRequest="1" BackgroundColor="#ddd"/>

      <!-- Transfer section -->
      <Label Text="РџРµСЂРµРІРѕРґ РІ IM-40 РїРѕ РєРѕРґСѓ" Style="{StaticResource SectionTitle}"/>
      <Entry Placeholder="РљРѕРґ РїР°СЂС‚РёРё" Text="{Binding TransferCode}"/>
      <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
        <Button Text="Р’С‹Р±СЂР°С‚СЊ С‚РѕРІР°СЂ" Clicked="OnPickProductForTransferClicked" Style="{StaticResource OutlinedButton}"/>
        <VerticalStackLayout Grid.Column="1" Spacing="2">
          <Label Text="{Binding TransferProductSku}" FontAttributes="Bold"/>
          <Label Text="{Binding TransferProductName}" FontSize="12" TextColor="Gray"/>
        </VerticalStackLayout>
        <Grid Grid.Column="2" ColumnDefinitions="*,Auto" ColumnSpacing="12">
          <Entry Grid.Column="0" Placeholder="РљРѕР»-РІРѕ" Text="{Binding TransferQty}" Keyboard="Numeric">
            <Entry.Behaviors>
              <behaviors:DecimalBehavior />
            </Entry.Behaviors>
          </Entry>
          <Button Grid.Column="1" Text="Р”РѕР±Р°РІРёС‚СЊ" Command="{Binding AddTransferItemCommand}" Style="{StaticResource OutlinedButton}"/>
        </Grid>
      </Grid>

      <HorizontalStackLayout Spacing="12">
        <Label Text="{Binding TransferNd40Qty, StringFormat='ND-40: {0:N0}'}" FontSize="11"/>
        <Label Text="{Binding TransferIm40Qty, StringFormat='IM-40: {0:N0}'}" FontSize="11"/>
        <Label Text="{Binding TransferTotalQty, StringFormat='Р’СЃРµРіРѕ: {0:N0}'}" FontSize="11"/>
      </HorizontalStackLayout>

      <CollectionView ItemsSource="{Binding TransferItems}">
        <CollectionView.Header>
          <Grid ColumnDefinitions="Auto,80,Auto" Padding="8" ColumnSpacing="12">
            <Label Text="ProductId" FontAttributes="Bold"/>
            <Label Grid.Column="1" Text="РљРѕР»-РІРѕ" FontAttributes="Bold" HorizontalTextAlignment="End"/>
            <Label Grid.Column="2" Text=""/>
          </Grid>
        </CollectionView.Header>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Grid ColumnDefinitions="Auto,80,Auto" ColumnSpacing="12" Padding="8">
              <Label Text="{Binding ProductId}"/>
              <Entry Grid.Column="1" Text="{Binding Qty, Mode=TwoWay}" Keyboard="Numeric" HorizontalTextAlignment="End" WidthRequest="80">
                <Entry.Behaviors>
                  <behaviors:DecimalBehavior />
                </Entry.Behaviors>
              </Entry>
              <Button Grid.Column="2" Text="РЈРґР°Р»РёС‚СЊ" Command="{Binding Source={x:Reference Root}, Path=BindingContext.RemoveTransferItemCommand}" CommandParameter="{Binding .}" Style="{StaticResource OutlinedButton}"/>
            </Grid>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>

      <Button Text="РџРµСЂРµРІРµСЃС‚Рё РІ IM-40" Command="{Binding TransferCommand}" Style="{StaticResource CtaPrimary}"/>

      <Label Text="{Binding StatusMessage}" TextColor="Red"/>
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>


