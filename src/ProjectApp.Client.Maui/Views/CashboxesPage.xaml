<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.CashboxesPage"
             Title="ÐšÐ°ÑÑÑ‹"
             BackgroundColor="{DynamicResource Color.Background}">
  
  <Grid RowDefinitions="Auto,*" Padding="16">
    
    <!-- Header with Total Balance -->
    <VerticalStackLayout Spacing="8">
      <Label Text="ðŸ’¼ ÐšÐ°ÑÑÑ‹ Ð¸ ÑÑ‡ÐµÑ‚Ð°" 
             FontSize="24" 
             FontAttributes="Bold"
             TextColor="{DynamicResource Color.Text.Primary}" />
      
      <Frame Padding="20" 
             Style="{StaticResource Card}"
             Margin="0,8,0,0">
        <VerticalStackLayout Spacing="4">
          <Label Text="ÐžÐ‘Ð©Ð˜Ð™ Ð‘ÐÐ›ÐÐÐ¡" 
                 FontSize="12" 
                 TextColor="{DynamicResource Color.Text.Secondary}" />
          <Label Text="{Binding TotalBalance, StringFormat='{0:N0} ÑÑƒÐ¼'}" 
                 FontSize="32" 
                 FontAttributes="Bold"
                 TextColor="{DynamicResource Color.Primary}" />
        </VerticalStackLayout>
      </Frame>
    </VerticalStackLayout>

    <!-- Cashboxes List -->
    <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Always">
      <CollectionView ItemsSource="{Binding Cashboxes}" Margin="0,0,12,0">
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Frame Padding="16" 
                   Margin="0,8,0,0" 
                   Style="{StaticResource CardFrame}">
              <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                
                <!-- Icon -->
                <Label Grid.Column="0" 
                       Grid.RowSpan="2"
                       Text="{Binding Icon, FallbackValue='ðŸ’°'}" 
                       FontSize="40" 
                       VerticalOptions="Center"
                       Margin="0,0,16,0" />
                
                <!-- Name and Type -->
                <VerticalStackLayout Grid.Column="1">
                  <Label Text="{Binding Name}" 
                         FontSize="18" 
                         FontAttributes="Bold"
                         TextColor="{DynamicResource Color.Text.Primary}" />
                  <Label Text="{Binding Type}" 
                         FontSize="12" 
                         TextColor="{DynamicResource Color.Text.Secondary}" />
                </VerticalStackLayout>
                
                <!-- Balance -->
                <VerticalStackLayout Grid.Column="2" 
                                     Grid.RowSpan="2"
                                     VerticalOptions="Center"
                                     HorizontalOptions="End">
                  <Label Text="{Binding Balance, StringFormat='{0:N0}'}" 
                         FontSize="20" 
                         FontAttributes="Bold"
                         TextColor="{DynamicResource Color.Text.Primary}"
                         HorizontalOptions="End" />
                  <Label Text="{Binding Currency}" 
                         FontSize="12" 
                         TextColor="{DynamicResource Color.Text.Tertiary}"
                         HorizontalOptions="End" />
                </VerticalStackLayout>
                
              </Grid>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>
    </ScrollView>
    
    <!-- Loading Indicator -->
    <ActivityIndicator Grid.Row="1"
                       IsRunning="{Binding IsBusy}"
                       IsVisible="{Binding IsBusy}"
                       Color="{DynamicResource Color.Primary}"
                       HorizontalOptions="Center"
                       VerticalOptions="Center" />
    
    <!-- Error Message -->
    <Label Grid.Row="1"
           Text="{Binding ErrorMessage}"
           IsVisible="{Binding ErrorMessage, Converter={StaticResource IsNotNullConverter}}"
           TextColor="Red"
           HorizontalOptions="Center"
           VerticalOptions="Center" />
    
  </Grid>
  
</ContentPage>
