<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProjectApp.Client.Maui.Views.SalesHistoryPage"
             x:Name="Page"
             Title="История продаж">
  <ScrollView>
    <VerticalStackLayout Padding="16" Spacing="12">
      <Grid ColumnDefinitions="*,*,Auto,Auto" ColumnSpacing="8">
        <HorizontalStackLayout Grid.Column="0" Spacing="8">
          <Label Text="От:" VerticalTextAlignment="Center"/>
          <Entry Text="{Binding DateFrom, StringFormat='{}{0:yyyy-MM-dd}'}"/>
        </HorizontalStackLayout>
        <HorizontalStackLayout Grid.Column="1" Spacing="8">
          <Label Text="До:" VerticalTextAlignment="Center"/>
          <Entry Text="{Binding DateTo, StringFormat='{}{0:yyyy-MM-dd}'}"/>
        </HorizontalStackLayout>
        <Button Grid.Column="2" Text="Обновить" Command="{Binding LoadCommand}"/>
        <HorizontalStackLayout Grid.Column="3" Spacing="8">
          <Label Text="Все продажи" VerticalTextAlignment="Center"/>
          <Switch IsToggled="{Binding ShowAll}"/>
        </HorizontalStackLayout>
      </Grid>

      <CollectionView ItemsSource="{Binding Items}">
        <CollectionView.ItemsLayout>
          <GridItemsLayout Orientation="Vertical" Span="2" />
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Frame Padding="10" HasShadow="False" CornerRadius="10">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto" ColumnSpacing="8">
                <Label Grid.Row="0" Grid.ColumnSpan="2" Text="{Binding Id, StringFormat='Продажа #{0}'}" FontAttributes="Bold"/>
                <Label Grid.Row="1" Grid.Column="0" Text="{Binding CreatedAt, StringFormat='{0:yyyy-MM-dd HH:mm}'}" FontSize="12" TextColor="Gray"/>
                <Label Grid.Row="2" Grid.Column="0" Text="{Binding ClientName}"/>
                <Label Grid.Row="3" Grid.Column="0" Text="{Binding PaymentType}" FontSize="12"/>
                <Label Grid.Row="3" Grid.Column="1" Text="{Binding Total, StringFormat='Сумма: {0:C}'}" HorizontalTextAlignment="End"/>
                <Button Grid.Row="1" Grid.Column="1" Text="Возврат" Command="{Binding Source={x:Reference Name=Page}, Path=BindingContext.OpenReturnCommand}" CommandParameter="{Binding .}"/>
              </Grid>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>
