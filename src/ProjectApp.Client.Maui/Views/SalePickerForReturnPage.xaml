<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.SalePickerForReturnPage"
             x:DataType="vm:SalePickerForReturnViewModel"
             Title="Ð’Ñ‹Ð±Ð¾Ñ€ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ Ð´Ð»Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°"
             BackgroundColor="{DynamicResource Color.Background}">

  <Grid RowDefinitions="Auto,Auto,Auto,*" Padding="16" RowSpacing="16">
    
    <!-- ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ñ‚Ð¸Ð¿Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶ -->
    <Grid Grid.Row="0" ColumnDefinitions="*,*" ColumnSpacing="8">
      <Border Grid.Column="0"
              StrokeThickness="1" 
              Stroke="{DynamicResource Color.Border}" 
              BackgroundColor="{DynamicResource Color.Surface}" 
              Padding="12,8" 
              StrokeShape="RoundRectangle 8">
        <Picker ItemsSource="{Binding SaleTypes}" 
                SelectedItem="{Binding SelectedSaleType}"
                FontSize="14"
                FontAttributes="Bold"
                TextColor="{DynamicResource Color.Text.Primary}"/>
      </Border>
      
      <Button Grid.Column="1" 
              Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ" 
              Command="{Binding LoadSalesCommand}"
              Style="{StaticResource Button.Primary}"/>
    </Grid>
    
    <!-- ÐŸÐ¾Ð¸ÑÐº -->
    <Grid Grid.Row="1">
      <Border StrokeThickness="1" 
              Stroke="{DynamicResource Color.Border}" 
              BackgroundColor="{DynamicResource Color.Surface}" 
              Padding="12,8" 
              StrokeShape="RoundRectangle 8">
        <Entry Text="{Binding SearchQuery}" 
               Placeholder="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ, Ð½Ð¾Ð¼ÐµÑ€Ñƒ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸..." 
               FontSize="14"
               BackgroundColor="Transparent"
               TextColor="{DynamicResource Color.Text.Primary}"/>
      </Border>
    </Grid>

    <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
    <ActivityIndicator Grid.Row="2" IsRunning="{Binding IsLoading}" IsVisible="{Binding IsLoading}"/>

    <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¾Ð´Ð°Ð¶ -->
    <ScrollView Grid.Row="3" VerticalScrollBarVisibility="Always">
      <VerticalStackLayout BindableLayout.ItemsSource="{Binding Sales}" Spacing="12">
        <BindableLayout.EmptyView>
          <VerticalStackLayout Padding="32" Spacing="12" HorizontalOptions="Center">
            <Label Text="ðŸ“¦" FontSize="48" HorizontalTextAlignment="Center"/>
            <Label Text="ÐÐµÑ‚ Ð¿Ñ€Ð¾Ð´Ð°Ð¶" FontSize="16" TextColor="{DynamicResource Color.Text.Secondary}" HorizontalTextAlignment="Center"/>
          </VerticalStackLayout>
        </BindableLayout.EmptyView>

        <BindableLayout.ItemTemplate>
          <DataTemplate x:DataType="vm:SaleForReturnRow">
            <Border StrokeThickness="1" 
                    Stroke="{DynamicResource Color.Border}" 
                    BackgroundColor="{DynamicResource Color.Surface}" 
                    Padding="16" 
                    StrokeShape="RoundRectangle 12">
              <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SalePickerForReturnViewModel}}, Path=SelectSaleCommand}" 
                                      CommandParameter="{Binding .}"/>
              </Border.GestureRecognizers>

              <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8">
                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <Label Text="{Binding Title}" FontSize="18" FontAttributes="Bold"/>
                  <Label Grid.Column="1" Text="{Binding Total, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="18" FontAttributes="Bold" TextColor="{DynamicResource Color.Primary}"/>
                </Grid>

                <!-- ÐšÐ»Ð¸ÐµÐ½Ñ‚ -->
                <Label Grid.Row="1" Text="{Binding ClientName}" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>

                <!-- Ð”ÐµÑ‚Ð°Ð»Ð¸ -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto">
                  <Label Text="{Binding PaymentTypeLabel}" FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}"/>
                  <Label Grid.Column="1" Text="{Binding ItemsCount, StringFormat='â€¢ {0} Ð¿Ð¾Ð·.'}" FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}" Margin="8,0,0,0"/>
                  <Label Grid.Column="2" Text="{Binding CreatedAt, StringFormat='{0:dd.MM.yyyy HH:mm}'}" FontSize="13" TextColor="{DynamicResource Color.Text.Secondary}"/>
                </Grid>

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° -->
                <Label Grid.Row="3" 
                       Text="{Binding ReturnStatusLabel}" 
                       FontSize="12" 
                       FontAttributes="Bold"
                       TextColor="{Binding ReturnStatusColor}"
                       IsVisible="{Binding HasReturn}"/>
              </Grid>
            </Border>
          </DataTemplate>
        </BindableLayout.ItemTemplate>
      </VerticalStackLayout>
    </ScrollView>
  </Grid>
</ContentPage>
