<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             xmlns:conv="clr-namespace:ProjectApp.Client.Maui.Converters"
             x:Class="ProjectApp.Client.Maui.Views.ContractsListPage"
             x:Name="Root"
             Title="Ð â€Ð Ñ•Ð Ñ–Ð Ñ•Ð Ð†Ð Ñ•Ð¡Ð‚Ð¡â€¹">
  <ContentPage.Content>
    <VerticalStackLayout Padding="24" Spacing="16">
      <CollectionView ItemsSource="{Binding Items}">
        <CollectionView.Header>
          <VerticalStackLayout Spacing="12" Padding="0,0,0,8">
            <HorizontalStackLayout Spacing="12">
              <Label Text="Ð ÐŽÐ¡â€šÐ Â°Ð¡â€šÐ¡Ñ“Ð¡Ðƒ:" VerticalTextAlignment="Center"/>
              <Picker ItemsSource="{Binding Statuses}" SelectedItem="{Binding SelectedStatus}" WidthRequest="180"/>
              <Button Text="Ð Ñ›Ð Â±Ð Ð…Ð Ñ•Ð Ð†Ð Ñ‘Ð¡â€šÐ¡ÐŠ" Command="{Binding RefreshAsyncCommand}" ImageSource="{StaticResource IconRefresh}" ContentLayout="Left,8" Style="{StaticResource OutlinedButton}"/>
              <Button Text="Ð ÐŽÐ Ñ•Ð Â·Ð Ò‘Ð Â°Ð¡â€šÐ¡ÐŠ" Clicked="OnCreateClicked" IsVisible="{Binding IsAdmin}" ImageSource="{StaticResource IconAdd}" ContentLayout="Left,8" Style="{StaticResource CtaPrimary}"/>
            </HorizontalStackLayout>
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}"/>
          </VerticalStackLayout>
        </CollectionView.Header>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Frame Style="{StaticResource CardFrame}" Padding="16" Margin="0,0,0,12"
                   BackgroundColor="{Binding Status, Converter={conv:ContractStatusToColorConverter}, ConverterParameter=bg}"
                   BorderColor="{Binding Status, Converter={conv:ContractStatusToColorConverter}, ConverterParameter=border}">
              <Frame.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding Source={x:Reference Root}, Path=BindingContext.OpenDetailsCommand}" CommandParameter="{Binding .}"/>
              </Frame.GestureRecognizers>
              <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="12">
                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <VerticalStackLayout Grid.Column="0" Spacing="4">
                    <Label Text="{Binding OrgName}" FontSize="18" FontAttributes="Bold"/>
                    <Label Text="{Binding Inn, StringFormat='Ð˜ÐÐ: {0}'}" FontSize="13" TextColor="{StaticResource MutedTextColor}" IsVisible="{Binding Inn, Converter={conv:IsNotNullOrEmptyConverter}}"/>
                    <Label Text="{Binding Phone, StringFormat='Ð¢ÐµÐ»: {0}'}" FontSize="13" TextColor="{StaticResource MutedTextColor}" IsVisible="{Binding Phone, Converter={conv:IsNotNullOrEmptyConverter}}"/>
                  </VerticalStackLayout>
                  <Frame Grid.Column="1" Style="{StaticResource BadgeFrame}"
                         BackgroundColor="{Binding Status, Converter={conv:ContractStatusToColorConverter}, ConverterParameter=bg}"
                         BorderColor="{Binding Status, Converter={conv:ContractStatusToColorConverter}, ConverterParameter=border}">
                    <Label Text="{Binding Status, Converter={conv:ContractStatusToTextConverter}}" FontSize="13" FontAttributes="Bold"
                           TextColor="{Binding Status, Converter={conv:ContractStatusToColorConverter}, ConverterParameter=text}"/>
                  </Frame>
                </Grid>

                <!-- Ð”Ð°Ñ‚Ð° -->
                <Label Grid.Row="1" Text="{Binding CreatedAt, Converter={conv:DateTimeToRuConverter}, StringFormat='Ð¡Ð¾Ð·Ð´Ð°Ð½: {0}'}" FontSize="12" TextColor="{StaticResource MutedTextColor}"/>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ -->
                <Button Grid.Row="2" 
                        Text="ðŸ“‹ ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ"
                        Command="{Binding Source={x:Reference Root}, Path=BindingContext.OpenDetailsCommand}"
                        CommandParameter="{Binding .}"
                        FontSize="14"
                        Padding="12,8"/>
              </Grid>
            </Frame>
          </DataTemplate>
        </CollectionView.ItemTemplate>
        <CollectionView.EmptyView>
          <VerticalStackLayout Padding="12" Spacing="6">
            <Label Text="Ð ÑœÐ ÂµÐ¡â€š Ð Ò‘Ð Ñ•Ð Ñ–Ð Ñ•Ð Ð†Ð Ñ•Ð¡Ð‚Ð Ñ•Ð Ð† Ð Ñ—Ð Ñ• Ð Ð†Ð¡â€¹Ð Â±Ð¡Ð‚Ð Â°Ð Ð…Ð Ð…Ð Ñ•Ð Ñ˜Ð¡Ñ“ Ð¡â€žÐ Ñ‘Ð Â»Ð¡ÐŠÐ¡â€šÐ¡Ð‚Ð¡Ñ“" FontAttributes="Bold" TextColor="{StaticResource MutedTextColor}"/>
            <Label Text="Ð Â˜Ð Â·Ð Ñ˜Ð ÂµÐ Ð…Ð Ñ‘Ð¡â€šÐ Âµ Ð¡â€žÐ Ñ‘Ð Â»Ð¡ÐŠÐ¡â€šÐ¡Ð‚ Ð¡ÐƒÐ¡â€šÐ Â°Ð¡â€šÐ¡Ñ“Ð¡ÐƒÐ Â° Ð Ñ‘Ð Â»Ð Ñ‘ Ð Ñ•Ð Â±Ð Ð…Ð Ñ•Ð Ð†Ð Ñ‘Ð¡â€šÐ Âµ Ð¡ÐƒÐ Ñ—Ð Ñ‘Ð¡ÐƒÐ Ñ•Ð Ñ”" FontSize="12" TextColor="{StaticResource MutedTextColor}"/>
          </VerticalStackLayout>
        </CollectionView.EmptyView>
      </CollectionView>
    </VerticalStackLayout>
  </ContentPage.Content>
</ContentPage>


