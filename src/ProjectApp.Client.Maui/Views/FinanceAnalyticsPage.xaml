<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ProjectApp.Client.Maui.ViewModels"
             x:Class="ProjectApp.Client.Maui.Views.FinanceAnalyticsPage"
             x:DataType="vm:AnalyticsViewModel"
             Title="Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°"
             BackgroundColor="{DynamicResource Color.Background}">
  
  <ScrollView Padding="16">
    <VerticalStackLayout Spacing="16">
      <Label Text="ðŸ“Š Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°" FontSize="24" FontAttributes="Bold" Margin="0,0,0,8"/>
      
      <!-- ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° -->
      <HorizontalStackLayout Spacing="12" Margin="0,0,0,16">
        <Border x:Name="PeriodMonth" Padding="16,8" BackgroundColor="{DynamicResource Color.Primary}" StrokeThickness="0" StrokeShape="RoundRectangle 20">
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnMonthTapped"/>
          </Border.GestureRecognizers>
          <Label Text="ÐœÐµÑÑÑ†" TextColor="White" FontSize="14" FontAttributes="Bold"/>
        </Border>
        
        <Border x:Name="PeriodYear" Padding="16,8" BackgroundColor="Transparent" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" StrokeShape="RoundRectangle 20">
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnYearTapped"/>
          </Border.GestureRecognizers>
          <Label Text="Ð“Ð¾Ð´" TextColor="{DynamicResource Color.Text.Primary}" FontSize="14"/>
        </Border>
        
        <Border Padding="16,8" BackgroundColor="Transparent" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" StrokeShape="RoundRectangle 20">
          <Border.GestureRecognizers>
            <TapGestureRecognizer Tapped="OnRefreshTapped"/>
          </Border.GestureRecognizers>
          <Label Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ" TextColor="{DynamicResource Color.Text.Primary}" FontSize="14"/>
        </Border>
      </HorizontalStackLayout>
      
      <!-- KPI ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
      <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="12">
        <!-- Ð’Ñ‹Ñ€ÑƒÑ‡ÐºÐ° -->
        <Border Grid.Row="0" Grid.Column="0" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeShape="RoundRectangle 12">
          <VerticalStackLayout Spacing="8">
            <Label Text="ðŸ’° Ð’Ñ‹Ñ€ÑƒÑ‡ÐºÐ°" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <Label Text="{Binding FinanceRevenue, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="20" FontAttributes="Bold"/>
          </VerticalStackLayout>
        </Border>
        
        <!-- Ð’Ð°Ð»Ð¾Ð²Ð°Ñ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ -->
        <Border Grid.Row="0" Grid.Column="1" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeShape="RoundRectangle 12">
          <VerticalStackLayout Spacing="8">
            <Label Text="ðŸ“ˆ Ð’Ð°Ð». Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <Label Text="{Binding FinanceGrossProfit, StringFormat='{0:N0} ÑÑƒÐ¼'}" FontSize="20" FontAttributes="Bold" TextColor="{DynamicResource Color.Success}"/>
          </VerticalStackLayout>
        </Border>
        
        <!-- ÐœÐ°Ñ€Ð¶Ð° -->
        <Border Grid.Row="1" Grid.Column="0" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeShape="RoundRectangle 12">
          <VerticalStackLayout Spacing="8">
            <Label Text="ðŸŽ¯ ÐœÐ°Ñ€Ð¶Ð°" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <Label Text="{Binding FinanceMargin, StringFormat='{0:F1}%'}" FontSize="20" FontAttributes="Bold" TextColor="{DynamicResource Color.Primary}"/>
          </VerticalStackLayout>
        </Border>
        
        <!-- ÐŸÑ€Ð¾Ð´Ð°Ð¶ -->
        <Border Grid.Row="1" Grid.Column="1" StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" StrokeShape="RoundRectangle 12">
          <VerticalStackLayout Spacing="8">
            <Label Text="ðŸ›’ ÐŸÑ€Ð¾Ð´Ð°Ð¶" FontSize="14" TextColor="{DynamicResource Color.Text.Secondary}"/>
            <Label Text="{Binding FinanceSalesCount}" FontSize="20" FontAttributes="Bold"/>
          </VerticalStackLayout>
        </Border>
      </Grid>
      
      <!-- Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° (Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·) -->
      <Border StrokeThickness="1" Stroke="{DynamicResource Color.Border}" BackgroundColor="{DynamicResource Color.Surface}" Padding="16" Margin="0,8,0,0" StrokeShape="RoundRectangle 12">
        <VerticalStackLayout Spacing="12">
          <Label Text="ðŸ“Š Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸" FontSize="18" FontAttributes="Bold"/>
          
          <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="8">
            <!-- Ð¡ÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ -->
            <Label Grid.Row="0" Grid.Column="0" Text="ðŸ’¸ Ð¡ÐµÐ±ÐµÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:" FontSize="14" VerticalTextAlignment="Center"/>
            <ProgressBar Grid.Row="0" Grid.Column="1" Progress="{Binding FinanceCostPercent}" ProgressColor="{DynamicResource Color.Error}" HeightRequest="20" VerticalOptions="Center"/>
            <Label Grid.Row="0" Grid.Column="2" Text="{Binding FinanceCostPercent, StringFormat='{0:P0}'}" FontSize="14" FontAttributes="Bold" VerticalTextAlignment="Center"/>
            
            <!-- Ð’Ð°Ð»Ð¾Ð²Ð°Ñ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ -->
            <Label Grid.Row="1" Grid.Column="0" Text="âœ… Ð’Ð°Ð». Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ:" FontSize="14" VerticalTextAlignment="Center"/>
            <ProgressBar Grid.Row="1" Grid.Column="1" Progress="{Binding FinanceProfitPercent}" ProgressColor="{DynamicResource Color.Success}" HeightRequest="20" VerticalOptions="Center"/>
            <Label Grid.Row="1" Grid.Column="2" Text="{Binding FinanceProfitPercent, StringFormat='{0:P0}'}" FontSize="14" FontAttributes="Bold" VerticalTextAlignment="Center"/>
          </Grid>
        </VerticalStackLayout>
      </Border>
      
    </VerticalStackLayout>
  </ScrollView>
</ContentPage>
