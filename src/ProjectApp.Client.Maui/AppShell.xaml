<?xml version="1.0" encoding="utf-8"?>
<Shell xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
       xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:views="clr-namespace:ProjectApp.Client.Maui.Views"
       xmlns:controls="clr-namespace:ProjectApp.Client.Maui.Controls"
       x:Class="ProjectApp.Client.Maui.AppShell"
       x:Name="RootShell"
       Shell.BackgroundColor="{DynamicResource Color.Background}"
       Shell.ForegroundColor="{DynamicResource Color.Text.Primary}"
       Shell.TitleColor="{DynamicResource Color.Text.Primary}"
       Shell.DisabledColor="{DynamicResource Color.Text.Tertiary}"
       Shell.UnselectedColor="{DynamicResource Color.Text.Tertiary}"
       Shell.TabBarForegroundColor="{DynamicResource Color.Text.Primary}"
       Shell.TabBarBackgroundColor="{DynamicResource Color.Surface}"
       Shell.NavBarIsVisible="False"
       FlyoutWidth="280"
       FlyoutBehavior="Disabled">

  <Shell.Resources>
    <Style x:Key="NavigationRailButtonStyle"
           TargetType="Button"
           BasedOn="{StaticResource GhostButton}">
      <Setter Property="HorizontalOptions" Value="Fill" />
      <Setter Property="ContentLayout" Value="Left,12" />
      <Setter Property="Padding" Value="16,12" />
      <Setter Property="TextColor" Value="{DynamicResource Color.Text.Secondary}" />
    </Style>
  </Shell.Resources>

  <Shell.TitleView>
    <Grid x:Name="TitleBar" Padding="16,8" HeightRequest="70">
      <Grid.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
          <GradientStop Color="#0D47A1" Offset="0.0" />
          <GradientStop Color="#1976D2" Offset="1.0" />
        </LinearGradientBrush>
      </Grid.Background>
      <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="16">
        <!-- POJ PRO Branding -->
        <VerticalStackLayout Spacing="2" VerticalOptions="Center">
          <HorizontalStackLayout Spacing="8">
            <Frame Padding="8,4" CornerRadius="6" BackgroundColor="#1565C0" HasShadow="False">
              <Label Text="POJ" FontSize="20" FontAttributes="Bold" TextColor="White" />
            </Frame>
            <Label Text="PRO" FontSize="24" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" />
          </HorizontalStackLayout>
          <Label Text="{Binding UserDisplayName}" 
                 FontSize="12" 
                 TextColor="#E3F2FD" 
                 Margin="4,0,0,0"
                 FontAttributes="Italic"/>
        </VerticalStackLayout>
        
        <!-- Subtitle -->
        <Label Grid.Column="1"
               Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð°Ð¼Ð¸" 
               FontSize="12" 
               TextColor="#B3E5FC" 
               VerticalOptions="Center"
               HorizontalOptions="Start"/>
        
        <!-- Online/Offline Indicator -->
        <Frame Grid.Column="2"
               x:Name="StatusIndicator"
               Padding="12,8"
               CornerRadius="20"
               BackgroundColor="#4CAF50"
               HasShadow="False"
               VerticalOptions="Center">
          <HorizontalStackLayout Spacing="8">
            <Ellipse Fill="White" 
                     WidthRequest="12" 
                     HeightRequest="12"
                     VerticalOptions="Center"/>
            <Label Text="ÐžÐ½Ð»Ð°Ð¹Ð½" 
                   FontSize="13" 
                   FontAttributes="Bold"
                   TextColor="White"
                   VerticalOptions="Center"/>
          </HorizontalStackLayout>
        </Frame>
      </Grid>
    </Grid>
  </Shell.TitleView>

  <Shell.FlyoutHeader>
    <Grid Padding="20" HeightRequest="160">
      <Grid.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
          <GradientStop Color="#0D47A1" Offset="0.0" />
          <GradientStop Color="#1976D2" Offset="0.5" />
          <GradientStop Color="#42A5F5" Offset="1.0" />
        </LinearGradientBrush>
      </Grid.Background>
      <VerticalStackLayout VerticalOptions="Center" Spacing="8">
        <HorizontalStackLayout Spacing="10">
          <Frame Padding="10,6" CornerRadius="8" BackgroundColor="#1565C0" HasShadow="True">
            <Label Text="POJ" FontSize="28" FontAttributes="Bold" TextColor="White" />
          </Frame>
          <Label Text="PRO" FontSize="32" FontAttributes="Bold" TextColor="White" VerticalOptions="Center" />
        </HorizontalStackLayout>
        <Label Text="{Binding UserDisplayName}" 
               FontSize="14" 
               TextColor="White" 
               FontAttributes="Bold"
               Margin="4,0,0,0" />
        <Label Text="ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ" FontSize="11" TextColor="#B3E5FC" Margin="4,0,0,0" />
      </VerticalStackLayout>
    </Grid>
  </Shell.FlyoutHeader>

  <Shell.FlyoutFooter>
    <Button Text="Ð’Ñ‹Ñ…Ð¾Ð´" Margin="16" Clicked="OnLogoutClicked" BackgroundColor="{StaticResource Color.Error}" TextColor="White"/>
  </Shell.FlyoutFooter>

  <Shell.FlyoutContent>
    <Grid Background="{DynamicResource Color.Surface}" Padding="20,28" RowSpacing="{StaticResource Space.6}">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>
      <VerticalStackLayout Spacing="{StaticResource Space.1}">
        <HorizontalStackLayout Spacing="8">
          <Label Text="POJ"
                 FontSize="{StaticResource Font.Size.H2}"
                 FontAttributes="Bold"
                 TextColor="#1976D2" />
          <Label Text="PRO"
                 FontSize="{StaticResource Font.Size.H2}"
                 FontAttributes="Bold"
                 TextColor="{DynamicResource Color.Text.Primary}" />
        </HorizontalStackLayout>
        <Label Text="{Binding UserDisplayName}"
               FontSize="{StaticResource Font.Size.Body.Small}"
               FontAttributes="Bold"
               TextColor="#1976D2" 
               Margin="0,4,0,0"/>
        <Label Text="ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"
               FontSize="{StaticResource Font.Size.Body.Small}"
               TextColor="{DynamicResource Color.Text.Secondary}" />
      </VerticalStackLayout>

      <VerticalStackLayout Grid.Row="1" Spacing="{StaticResource Space.2}">
        <!-- Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð²ÑÐµÐ¼ -->
        <Button x:Name="DashboardRailButton"
                Text="ðŸ  Ð“Ð»Ð°Ð²Ð½Ð°Ñ"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="dashboard"
                Clicked="OnNavRailClicked"
                SemanticProperties.Description="ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° Ð³Ð»Ð°Ð²Ð½ÑƒÑŽ Ð¿Ð°Ð½ÐµÐ»ÑŒ" />
        <Button Text="ðŸ›’ ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð¸"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="sales"
                Clicked="OnNavRailClicked"
                SemanticProperties.Description="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¿Ñ€Ð¾Ð´Ð°Ð¶" />
        <Button Text="ðŸ‘¥ ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="clients"
                Clicked="OnNavRailClicked"
                SemanticProperties.Description="ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼" />
        <Button Text="ðŸ“¦ Ð¡ÐºÐ»Ð°Ð´"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="inventory"
                Clicked="OnNavRailClicked"
                SemanticProperties.Description="ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº ÑÐºÐ»Ð°Ð´Ñƒ" />
        
        <!-- Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÐÐ´Ð¼Ð¸Ð½Ð° -->
        <Button x:Name="FinancesRailButton"
                Text="ðŸ’° Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="finances"
                Clicked="OnNavRailClicked"
                IsVisible="False"
                SemanticProperties.Description="ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ñ„Ð¸Ð½Ð°Ð½ÑÐ°Ð¼" />
        <Button x:Name="AnalyticsRailButton"
                Text="ðŸ“Š ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="analytics"
                Clicked="OnNavRailClicked"
                IsVisible="False"
                SemanticProperties.Description="ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐµ" />
        
        <Button Text="âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"
                Style="{StaticResource NavigationRailButtonStyle}"
                CommandParameter="settings"
                Clicked="OnNavRailClicked"
                SemanticProperties.Description="ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸" />
      </VerticalStackLayout>
    </Grid>
  </Shell.FlyoutContent>

  <VisualStateManager.VisualStateGroups>
    <VisualStateGroup x:Name="BreakpointStates">
      <VisualState x:Name="Compact" />
      <VisualState x:Name="Medium" />
      <VisualState x:Name="Expanded" />
    </VisualStateGroup>
  </VisualStateManager.VisualStateGroups>

  <TabBar x:Name="MainTabBar">
    <!-- Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð²ÑÐµÐ¼ -->
    <ShellContent x:Name="DashboardTab"
                  Route="dashboard"
                  Title="Ð“Ð»Ð°Ð²Ð½Ð°Ñ"
                  Icon="home.png"
                  ContentTemplate="{DataTemplate views:AdminDashboardPage}" />
    <ShellContent x:Name="SalesTab"
                  Route="sales"
                  Title="ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð¸"
                  Icon="sales.png"
                  ContentTemplate="{DataTemplate views:SaleStartPage}" />
    <ShellContent x:Name="ClientsTab"
                  Route="clients"
                  Title="ÐšÐ»Ð¸ÐµÐ½Ñ‚Ñ‹"
                  Icon="clients.png"
                  ContentTemplate="{DataTemplate views:ClientsListPage}" />
    <ShellContent x:Name="InventoryTab"
                  Route="inventory"
                  Title="Ð¡ÐºÐ»Ð°Ð´"
                  Icon="inventory.png"
                  ContentTemplate="{DataTemplate views:StocksPage}" />
    
    <!-- Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÐÐ´Ð¼Ð¸Ð½Ð° -->
    <ShellContent x:Name="FinancesTab"
                  Route="finances"
                  Title="Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹"
                  Icon="finances.png"
                  IsVisible="False"
                  ContentTemplate="{DataTemplate views:FinancesMenuPage}" />
    <ShellContent x:Name="AnalyticsTab"
                  Route="analytics"
                  Title="ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°"
                  Icon="analytics.png"
                  IsVisible="False"
                  ContentTemplate="{DataTemplate views:AnalyticsMenuPage}" />
    
    <ShellContent x:Name="SettingsTab"
                  Route="settings"
                  Title="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"
                  Icon="settings.png"
                  ContentTemplate="{DataTemplate views:SettingsPage}" />
  </TabBar>
</Shell>
