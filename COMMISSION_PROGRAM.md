# ü§ù –ü–ê–†–¢–ù–ï–†–°–ö–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê (–ö–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã)

## üìã –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** = —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å **–∞–≥–µ–Ω—Ç–∞–º–∏/–ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–º–∏—Å—Å–∏—é —Å –ø—Ä–æ–¥–∞–∂ –∏ –¥–æ–≥–æ–≤–æ—Ä–æ–≤.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–∞—Ä—Ç–Ω–µ—Ä –ø—Ä–∏–≤–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞** ‚Üí –ú—ã –ø—Ä–æ–¥–∞–µ–º —Ç–æ–≤–∞—Ä/–∑–∞–∫–ª—é—á–∞–µ–º –¥–æ–≥–æ–≤–æ—Ä
2. **–ù–∞—á–∏—Å–ª—è–µ–º –∫–æ–º–∏—Å—Å–∏—é –ø–∞—Ä—Ç–Ω–µ—Ä—É** ‚Üí % –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ (–≤—Ä—É—á–Ω—É—é)
3. **–í—ã–ø–ª–∞—á–∏–≤–∞–µ–º –∫–æ–º–∏—Å—Å–∏—é** ‚Üí –î–µ–Ω—å–≥–∞–º–∏ (–Ω–∞–ª–∏—á–Ω—ã–µ/–∫–∞—Ä—Ç–∞) –∏–ª–∏ —Ç–æ–≤–∞—Ä–æ–º

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

### 1. –ö–ª–∏–µ–Ω—Ç-–ø–∞—Ä—Ç–Ω–µ—Ä (Commission Agent)

```csharp
Client {
    IsCommissionAgent: bool           // –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
    CommissionBalance: decimal        // –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–æ–º–∏—Å—Å–∏–∏ (—Å–∫–æ–ª—å–∫–æ –¥–æ–ª–∂–Ω—ã)
    CommissionAgentSince: DateTime?   // –î–∞—Ç–∞ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
    CommissionNotes: string?          // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –ø–æ–∫–∞ –±–∞–ª–∞–Ω—Å != 0
- –ë–∞–ª–∞–Ω—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö/–≤—ã–ø–ª–∞—Ç–∞—Ö

---

### 2. –ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```csharp
Sale {
    CommissionAgentId: int?      // ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞
    CommissionRate: decimal?     // % –∫–æ–º–∏—Å—Å–∏–∏ (–≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é!)
    CommissionAmount: decimal?   // –°—É–º–º–∞ –∫–æ–º–∏—Å—Å–∏–∏ (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
}
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –ø—Ä–æ–¥–∞–∂:**
- ‚úÖ –ù–∞–ª–∏—á–Ω—ã–µ (—Å —á–µ–∫–æ–º/–±–µ–∑)
- ‚úÖ –ö–∞—Ä—Ç–∞  
- ‚úÖ Click
- ‚úÖ –ë—Ä–æ–Ω—å
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç (—Ç–æ–∂–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç –∫–æ–º–∏—Å—Å–∏—é!)
- ‚ùå Payme (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- ‚ùå –°–∞–π—Ç (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂–∏ —É–∫–∞–∑—ã–≤–∞–µ—à—å `CommissionAgentId` –∏ `CommissionRate`
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç `CommissionAmount = Total * CommissionRate / 100`
3. –ö–æ–º–∏—Å—Å–∏—è –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø–∞—Ä—Ç–Ω–µ—Ä—É –≤ —Ñ–æ–Ω–µ

---

### 3. –î–æ–≥–æ–≤–æ—Ä —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```csharp
Contract {
    CommissionAgentId: int?       // ID –ø–∞—Ä—Ç–Ω–µ—Ä–∞
    CommissionAmount: decimal?    // –°—É–º–º–∞ –∫–æ–º–∏—Å—Å–∏–∏ (–≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é!)
}
```

**–û—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ–¥–∞–∂:**
- –°—É–º–º–∞ –∫–æ–º–∏—Å—Å–∏–∏ –≤–≤–æ–¥–∏—Ç—Å—è **–í–†–£–ß–ù–£–Æ** (–Ω–µ –ø—Ä–æ—Ü–µ–Ω—Ç!)
- –ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞

---

### 4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏ (CommissionTransaction)

**–¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
- `Accrual` (0) - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ –ø—Ä–æ–¥–∞–∂—É
- `ContractAccrual` (1) - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ –¥–æ–≥–æ–≤–æ—Ä
- `PaymentCash` (2) - –í—ã–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏
- `PaymentCard` (3) - –í—ã–ø–ª–∞—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—É
- `PaymentProduct` (4) - –í—ã–ø–ª–∞—Ç–∞ —Ç–æ–≤–∞—Ä–æ–º
- `Adjustment` (5) - –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```csharp
CommissionTransaction {
    CommissionAgentId: int
    Type: CommissionTransactionType
    Amount: decimal                  // + –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ, - –≤—ã–ø–ª–∞—Ç–∞
    BalanceAfter: decimal            // –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    RelatedSaleId: int?              // –°–≤—è–∑—å —Å –ø—Ä–æ–¥–∞–∂–µ–π
    RelatedContractId: int?          // –°–≤—è–∑—å —Å –¥–æ–≥–æ–≤–æ—Ä–æ–º
    CreatedAt: DateTime
    CreatedBy: string?
    Notes: string?
}
```

---

## üìä –ë–∞–ª–∞–Ω—Å –∫–æ–º–∏—Å—Å–∏–∏

### –§–æ—Ä–º—É–ª–∞:
```
–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å = 
  + –í—Å–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (Accrual + ContractAccrual)
  - –í—Å–µ –≤—ã–ø–ª–∞—Ç—ã (PaymentCash + PaymentCard + PaymentProduct)
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
- ‚úÖ –ü—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –∫–æ–º–∏—Å—Å–∏–∏ ‚Üí –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ –ü—Ä–∏ –≤—ã–ø–ª–∞—Ç–µ –∫–æ–º–∏—Å—Å–∏–∏ ‚Üí –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `BalanceAfter` –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

---

## üîå API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏

**1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤**
```http
GET /api/commission/agents
```

**2. –°–¥–µ–ª–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º**
```http
POST /api/commission/agents/{clientId}
Body: { "notes": "–•–æ—Ä–æ—à–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä" }
```

**3. –£–±—Ä–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞** (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å = 0)
```http
DELETE /api/commission/agents/{clientId}
```

---

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏

**4. –ù–∞—á–∏—Å–ª–∏—Ç—å –∑–∞ –ø—Ä–æ–¥–∞–∂—É** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂–∏)
```http
POST /api/commission/accrue/sale
Body: {
  "saleId": 123,
  "commissionAgentId": 45,
  "saleTotal": 1000000,
  "commissionRate": 5.0
}
```

**5. –ù–∞—á–∏—Å–ª–∏—Ç—å –∑–∞ –¥–æ–≥–æ–≤–æ—Ä** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞)
```http
POST /api/commission/accrue/contract
Body: {
  "contractId": 78,
  "commissionAgentId": 45,
  "commissionAmount": 500000
}
```

---

### –í—ã–ø–ª–∞—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏

**6. –í—ã–ø–ª–∞—Ç–∏—Ç—å –¥–µ–Ω—å–≥–∞–º–∏** (–Ω–∞–ª–∏—á–Ω—ã–µ –∏–ª–∏ –∫–∞—Ä—Ç–∞)
```http
POST /api/commission/pay/cash
Body: {
  "commissionAgentId": 45,
  "amount": 300000,
  "isCard": false,          // false = –Ω–∞–ª–∏—á–Ω—ã–µ, true = –∫–∞—Ä—Ç–∞
  "notes": "–í—ã–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å"
}
```

**7. –í—ã–ø–ª–∞—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä–æ–º** (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∂–∏)
```http
POST /api/commission/pay/product
Body: {
  "commissionAgentId": 45,
  "saleId": 999,
  "saleTotal": 250000
}
```

---

### –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**8. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä–∞**
```http
GET /api/commission/agents/{agentId}/transactions?from=2025-01-01&to=2025-01-31
```

**9. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–∞—Ä—Ç–Ω–µ—Ä–∞**
```http
GET /api/commission/agents/{agentId}/stats
```

–û—Ç–≤–µ—Ç:
```json
{
  "agentId": 45,
  "agentName": "–û–û–û –ü–∞—Ä—Ç–Ω–µ—Ä",
  "currentBalance": 450000,
  "totalAccrued": 2500000,
  "totalPaid": 2050000,
  "salesCount": 25,
  "contractsCount": 3,
  "agentSince": "2025-01-01T00:00:00Z"
}
```

**10. –ü–æ–ª—É—á–∏—Ç—å –æ–±—â–∏–π –æ—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º**
```http
GET /api/commission/report?from=2025-01-01&to=2025-01-31
```

–û—Ç–≤–µ—Ç:
```json
{
  "totalAgents": 5,
  "totalBalance": 1250000,
  "totalAccrued": 10000000,
  "totalPaid": 8750000,
  "agents": [...]
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–¥–∞–∂–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```http
POST /api/sales
Body: {
  "clientId": 100,
  "clientName": "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å",
  "items": [...],
  "paymentType": "CashWithReceipt",
  "commissionAgentId": 45,      // ‚Üê –ü–∞—Ä—Ç–Ω–µ—Ä
  "commissionRate": 5.0          // ‚Üê 5% –∫–æ–º–∏—Å—Å–∏–∏
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∞ –Ω–∞ —Å—É–º–º—É 1,000,000 UZS
2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è: 1,000,000 * 5% = 50,000 UZS
3. –ü–∞—Ä—Ç–Ω–µ—Ä—É ‚Ññ45 –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 50,000 UZS
4. –ë–∞–ª–∞–Ω—Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: 450,000 ‚Üí 500,000 UZS

---

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–≥–æ–≤–æ—Ä —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞

```http
POST /api/contracts
Body: {
  "orgName": "–û–û–û –ö–ª–∏–µ–Ω—Ç",
  "items": [...],
  "commissionAgentId": 45,         // ‚Üê –ü–∞—Ä—Ç–Ω–µ—Ä
  "commissionAmount": 250000       // ‚Üê –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ (–≤—Ä—É—á–Ω—É—é!)
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –¥–æ–≥–æ–≤–æ—Ä
2. –ü–∞—Ä—Ç–Ω–µ—Ä—É ‚Ññ45 –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 250,000 UZS
3. –ë–∞–ª–∞–Ω—Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: 500,000 ‚Üí 750,000 UZS

---

### –ü—Ä–∏–º–µ—Ä 3: –í—ã–ø–ª–∞—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞–ª–∏—á–Ω—ã–º–∏

```http
POST /api/commission/pay/cash
Body: {
  "commissionAgentId": 45,
  "amount": 300000,
  "isCard": false,
  "notes": "–í—ã–ø–ª–∞—Ç–∞ –∑–∞ —è–Ω–≤–∞—Ä—å 2025"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 300,000 UZS —Å –±–∞–ª–∞–Ω—Å–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
2. –ë–∞–ª–∞–Ω—Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: 750,000 ‚Üí 450,000 UZS
3. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è `PaymentCash`

---

### –ü—Ä–∏–º–µ—Ä 4: –í—ã–ø–ª–∞—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ —Ç–æ–≤–∞—Ä–æ–º

**–®–∞–≥ 1:** –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–¥–∞–∂—É –ø–∞—Ä—Ç–Ω–µ—Ä—É
```http
POST /api/sales
Body: {
  "clientId": 45,              // ‚Üê –ü—Ä–æ–¥–∞–∂–∞ —Å–∞–º–æ–º—É –ø–∞—Ä—Ç–Ω–µ—Ä—É!
  "clientName": "–û–û–û –ü–∞—Ä—Ç–Ω–µ—Ä",
  "items": [...],
  "paymentType": "CashWithReceipt"
}
// –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏: 200,000 UZS
```

**–®–∞–≥ 2:** –°–ø–∏—Å—ã–≤–∞–µ–º —Å –±–∞–ª–∞–Ω—Å–∞ –∫–æ–º–∏—Å—Å–∏–∏
```http
POST /api/commission/pay/product
Body: {
  "commissionAgentId": 45,
  "saleId": 999,               // ‚Üê ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏
  "saleTotal": 200000
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è 200,000 UZS —Å –±–∞–ª–∞–Ω—Å–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
2. –ë–∞–ª–∞–Ω—Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞: 450,000 ‚Üí 250,000 UZS
3. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è `PaymentProduct` —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∂—É

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: Clients (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

```sql
ALTER TABLE Clients 
ADD COLUMN IsCommissionAgent BOOLEAN NOT NULL DEFAULT FALSE,
ADD COLUMN CommissionBalance DECIMAL(18,2) NOT NULL DEFAULT 0,
ADD COLUMN CommissionAgentSince DATETIME(6) NULL,
ADD COLUMN CommissionNotes TEXT NULL;
```

### –¢–∞–±–ª–∏—Ü–∞: Sales (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

```sql
ALTER TABLE Sales 
ADD COLUMN CommissionAgentId INT NULL,
ADD COLUMN CommissionRate DECIMAL(5,2) NULL,
ADD COLUMN CommissionAmount DECIMAL(18,2) NULL;
```

### –¢–∞–±–ª–∏—Ü–∞: Contracts (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)

```sql
ALTER TABLE Contracts
ADD COLUMN CommissionAgentId INT NULL,
ADD COLUMN CommissionAmount DECIMAL(18,2) NULL;
```

### –¢–∞–±–ª–∏—Ü–∞: CommissionTransactions (–Ω–æ–≤–∞—è)

```sql
CREATE TABLE CommissionTransactions (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    CommissionAgentId INT NOT NULL,
    Type INT NOT NULL,
    Amount DECIMAL(18,2) NOT NULL,
    BalanceAfter DECIMAL(18,2) NOT NULL,
    RelatedSaleId INT NULL,
    RelatedContractId INT NULL,
    CreatedAt DATETIME(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    CreatedBy VARCHAR(255) NULL,
    Notes TEXT NULL,
    
    INDEX IX_CommissionTransactions_AgentId (CommissionAgentId),
    INDEX IX_CommissionTransactions_Type (Type),
    
    FOREIGN KEY (CommissionAgentId) REFERENCES Clients(Id) ON DELETE CASCADE
);
```

---

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Railway CLI

```powershell
cd c:\projectApp
railway login
railway link
Get-Content "add-commission-sales.sql" | railway run mysql
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

1. –û—Ç–∫—Ä–æ–π Railway ‚Üí –¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí MySQL
2. –ù–∞–∂–º–∏ **"Query"**
3. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `add-commission-sales.sql`
4. –í—Å—Ç–∞–≤—å –∏ –≤—ã–ø–æ–ª–Ω–∏

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ MySQL Workbench/phpMyAdmin

1. –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ Railway MySQL
2. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `add-commission-sales.sql`
3. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Swagger

1. –ó–∞–ø—É—Å—Ç–∏ API: `dotnet run --project src/ProjectApp.Api/ProjectApp.Api.csproj`
2. –û—Ç–∫—Ä–æ–π: `http://localhost:5028/swagger`
3. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è (–ø–æ–ª—É—á–∏ JWT —Ç–æ–∫–µ–Ω)
4. –¢–µ—Å—Ç–∏—Ä—É–π —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/commission/*`

**Swagger —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/commission/agents/{id}` - –°–¥–µ–ª–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º
- `GET /api/commission/agents` - –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- `GET /api/commission/agents/{id}/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `POST /api/commission/pay/cash` - –í—ã–ø–ª–∞—Ç–∞ –¥–µ–Ω—å–≥–∞–º–∏
- `GET /api/commission/report` - –û–±—â–∏–π –æ—Ç—á–µ—Ç

---

## üìä –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:
- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–æ–º–∏—Å—Å–∏–∏
- –í—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ
- –í—Å–µ–≥–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–≥–æ–≤–æ—Ä–æ–≤
- –î–∞—Ç–∞ —Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º

### –û–±—â–∏–π –æ—Ç—á–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
- –û–±—â–∏–π –±–∞–ª–∞–Ω—Å –∫–æ–º–∏—Å—Å–∏–π (–¥–æ–ª–≥ –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏)
- –í—Å–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥
- –í—Å–µ–≥–æ –≤—ã–ø–ª–∞—á–µ–Ω–æ –∑–∞ –ø–µ—Ä–∏–æ–¥
- –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –±–∞–ª–∞–Ω—Å—É)

---

## üé® UI (–±—É–¥—É—â–µ–µ)

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:**
- –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ "–°–¥–µ–ª–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–ª–∏–µ–Ω—Ç–∞
- –í—ã–±–æ—Ä –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂–∏
- –í–≤–æ–¥ % –∫–æ–º–∏—Å—Å–∏–∏ –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—É–º–º—ã
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- –§–æ—Ä–º–∞ –≤—ã–ø–ª–∞—Ç—ã –∫–æ–º–∏—Å—Å–∏–∏
- –û—Ç—á–µ—Ç—ã –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (`[Authorize]`)
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ —Å –Ω–µ–Ω—É–ª–µ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º
- –ù–µ–ª—å–∑—è –≤—ã–ø–ª–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ —á–µ–º –±–∞–ª–∞–Ω—Å
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å `CreatedBy`
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã (—Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ)

---

## üéâ –°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í–û 100%!

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
- ‚úÖ CommissionService (–≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- ‚úÖ CommissionController (10 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SalesController
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ContractsController
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏
- ‚úÖ –í—ã–ø–ª–∞—Ç–∞ –¥–µ–Ω—å–≥–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–æ–º
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã

**–§–∞–π–ª—ã:**
- `/Models/Client.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `/Models/Sale.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `/Models/Contract.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `/Models/CommissionTransaction.cs` - —Å–æ–∑–¥–∞–Ω
- `/Services/CommissionService.cs` - —Å–æ–∑–¥–∞–Ω
- `/Controllers/CommissionController.cs` - —Å–æ–∑–¥–∞–Ω
- `/Dtos/SaleDtos.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `/Dtos/ContractDtos.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω
- `/add-commission-sales.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- `/COMMISSION_PROGRAM.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞: 98% ‚Üí 100%!** üöÄ
