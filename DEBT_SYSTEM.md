# üí∞ –°–ò–°–¢–ï–ú–ê –î–û–õ–ì–û–í - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–î–æ–ª–≥** = –æ—Ç–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É —Å –æ—Ç—Å—Ä–æ—á–µ–Ω–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π. –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏ —Ü–µ–Ω—ã, —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã. –ö–ª–∏–µ–Ω—Ç –ø–ª–∞—Ç–∏—Ç –ø–æ –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–π —Ü–µ–Ω–µ, –Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –¥–æ–ª–≥–µ.

---

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–≥–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ —Å —Ç–∏–ø–æ–º "–í –¥–æ–ª–≥"  
‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã/–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –¥–æ–ª–≥–µ  
‚úÖ **–ß–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞** - –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–ª–∞—Ç–∏—Ç—å –ø–æ —á–∞—Å—Ç—è–º  
‚úÖ **–°–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–∏–∫–æ–≤** - –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∏–º–µ—é—â–∏–º–∏ –¥–æ–ª–≥–∏  
‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫** - –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤–∏–¥–Ω–æ –µ–≥–æ –¥–æ–ª–≥ –∏ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏  
‚úÖ **–û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫** - —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç –Ω–∞–±—Ä–∞–ª —Ç–æ–≤–∞—Ä–∞ –Ω–∞ N —Å—É–º  

---

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### **1. Debt (–î–æ–ª–≥)**

```csharp
public class Debt
{
    public int Id { get; set; }
    public int ClientId { get; set; }       // –ö–ª–∏–µ–Ω—Ç-–¥–æ–ª–∂–Ω–∏–∫
    public int SaleId { get; set; }         // –°–≤—è–∑—å —Å –ø—Ä–æ–¥–∞–∂–µ–π
    public decimal Amount { get; set; }     // –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞
    public decimal OriginalAmount { get; set; }  // –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
    public DateTime DueDate { get; set; }   // –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã
    public DebtStatus Status { get; set; }  // –°—Ç–∞—Ç—É—Å
    public List<DebtItem> Items { get; set; }  // –¢–æ–≤–∞—Ä—ã –≤ –¥–æ–ª–≥–µ
    public string? Notes { get; set; }      // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
    public DateTime CreatedAt { get; set; }
    public string? CreatedBy { get; set; }
}
```

### **2. DebtItem (–¢–æ–≤–∞—Ä –≤ –¥–æ–ª–≥–µ)**

```csharp
public class DebtItem
{
    public int Id { get; set; }
    public int DebtId { get; set; }
    public int ProductId { get; set; }
    public string ProductName { get; set; }
    public string? Sku { get; set; }
    public decimal Qty { get; set; }        // –ú–û–ñ–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨!
    public decimal Price { get; set; }      // –ú–û–ñ–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨!
    public decimal Total { get; set; }      // Qty * Price
    public DateTime CreatedAt { get; set; }
    public DateTime? UpdatedAt { get; set; }
    public string? UpdatedBy { get; set; }
}
```

### **3. –°—Ç–∞—Ç—É—Å—ã –¥–æ–ª–≥–∞**

```csharp
public enum DebtStatus
{
    Open = 0,      // –û—Ç–∫—Ä—ã—Ç (–∞–∫—Ç–∏–≤–Ω—ã–π –¥–æ–ª–≥)
    Paid = 1,      // –û–ø–ª–∞—á–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
    Overdue = 2,   // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω
    Canceled = 3   // –û—Ç–º–µ–Ω–µ–Ω
}
```

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–≥–∞**

**–®–∞–≥ 1:** –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–¥–∞–∂—É —Å —Ç–∏–ø–æ–º `Debt`

```http
POST /api/sales
Authorization: Bearer <token>
Content-Type: application/json

{
  "clientId": 5,                    // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
  "clientName": "–û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞",
  "paymentType": 11,                // 11 = Debt
  "debtDueDate": "2025-02-18",      // –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é +30 –¥–Ω–µ–π)
  "debtNotes": "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç",
  "items": [
    {
      "productId": 1,
      "qty": 10,
      "unitPrice": 150000
    },
    {
      "productId": 3,
      "qty": 5,
      "unitPrice": 350000
    }
  ]
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∞ —Å `PaymentType = Debt`
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `Debts`
3. ‚úÖ –¢–æ–≤–∞—Ä—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `DebtItems`
4. ‚úÖ –î–æ–ª–≥ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `Open`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "id": 123,
  "clientId": 5,
  "saleId": 999,
  "amount": 3250000,
  "originalAmount": 3250000,
  "dueDate": "2025-02-18",
  "status": 0,
  "items": [
    {
      "id": 1,
      "productId": 1,
      "productName": "–û–ü-1 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 1 –∫–≥",
      "qty": 10,
      "price": 150000,
      "total": 1500000
    },
    {
      "id": 2,
      "productId": 3,
      "productName": "–û–ü-5 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 5 –∫–≥",
      "qty": 5,
      "price": 350000,
      "total": 1750000
    }
  ]
}
```

---

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –¥–æ–ª–≥–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:** –¶–µ–Ω–∞ –Ω–∞ —Ç–æ–≤–∞—Ä –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¥–æ–ª–≥.

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –¥–æ–ª–≥–µ

```http
PUT /api/debts/123/items
Authorization: Bearer <token>
Content-Type: application/json

{
  "items": [
    {
      "id": 1,
      "productId": 1,
      "productName": "–û–ü-1 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 1 –∫–≥",
      "sku": "OP-1",
      "qty": 10,
      "price": 160000,     // ‚Üê –ü–æ–≤—ã—Å–∏–ª–∏ —Ü–µ–Ω—É!
      "total": 1600000
    },
    {
      "id": 2,
      "productId": 3,
      "productName": "–û–ü-5 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 5 –∫–≥",
      "sku": "OP-5",
      "qty": 5,
      "price": 350000,
      "total": 1750000
    }
  ]
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `Qty`, `Price`, `Total` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
2. ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞
3. ‚úÖ –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –æ–ø–ª–∞—Ç—ã
4. ‚úÖ –ï—Å–ª–∏ –¥–æ–ª–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–ª–∞—á–µ–Ω ‚Üí —Å—Ç–∞—Ç—É—Å `Paid`

**–§–æ—Ä–º—É–ª–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞:**
```
newTotal = Œ£Items.Total
paidAmount = OriginalAmount - Amount
newDebtAmount = max(0, newTotal - paidAmount)
```

---

### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ß–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –¥–æ–ª–≥–∞**

**–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω–µ—Å 1,000,000 —Å—É–º:**

```http
POST /api/debts/123/pay
Authorization: Bearer <token>
Content-Type: application/json

{
  "amount": 1000000
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "id": 123,
  "amount": 2350000,    // –ë—ã–ª–æ 3350000, —Å—Ç–∞–ª–æ 2350000
  "status": 0           // –í—Å—ë –µ—â—ë Open
}
```

**–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω–µ—Å –µ—â—ë 2,350,000 —Å—É–º:**

```http
POST /api/debts/123/pay
{
  "amount": 2350000
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "id": 123,
  "amount": 0,         // –î–æ–ª–≥ –ø–æ–≥–∞—à–µ–Ω!
  "status": 1          // –°—Ç–∞—Ç—É—Å ‚Üí Paid
}
```

---

## üìä API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### **–†–∞–±–æ—Ç–∞ —Å –¥–æ–ª–≥–∞–º–∏**

**1. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–ª–≥–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)**
```http
GET /api/debts?clientId=5&status=0&from=2025-01-01&to=2025-12-31&page=1&size=50
```

**2. –î–µ—Ç–∞–ª–∏ –¥–æ–ª–≥–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏**
```http
GET /api/debts/123
```

–û—Ç–≤–µ—Ç:
```json
{
  "id": 123,
  "clientId": 5,
  "clientName": "–û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞",
  "saleId": 999,
  "amount": 3350000,
  "originalAmount": 3350000,
  "paidAmount": 0,
  "dueDate": "2025-02-18",
  "status": "Open",
  "items": [...],
  "notes": "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç",
  "createdAt": "2025-01-18T12:00:00Z",
  "createdBy": "manager1"
}
```

**3. –î–æ–ª–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞**
```http
GET /api/debts/by-client/5
```

–û—Ç–≤–µ—Ç:
```json
{
  "clientId": 5,
  "totalDebt": 3350000,
  "debts": [...]
}
```

**4. –ò—Å—Ç–æ—Ä–∏—è –æ–ø–ª–∞—Ç –¥–æ–ª–≥–∞**
```http
GET /api/debts/123/payments
```

**5. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –¥–æ–ª–≥–µ**
```http
PUT /api/debts/123/items
Body: { "items": [...] }
```

**6. –û–ø–ª–∞—Ç–∏—Ç—å –¥–æ–ª–≥**
```http
POST /api/debts/123/pay
Body: { "amount": 1000000 }
```

---

### **–†–∞–±–æ—Ç–∞ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏**

**7. –°–ø–∏—Å–æ–∫ –î–û–õ–ñ–ù–ò–ö–û–í (–∫–ª–∏–µ–Ω—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–ª–≥–∞–º–∏)**
```http
GET /api/clients/debtors?page=1&size=50
```

–û—Ç–≤–µ—Ç:
```json
{
  "items": [
    {
      "clientId": 5,
      "clientName": "–û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞",
      "phone": "+998901234567",
      "type": "Company",
      "totalDebt": 3350000,
      "debtsCount": 1,
      "oldestDueDate": "2025-02-18"
    },
    {
      "clientId": 8,
      "clientName": "–ò–ü –ò–≤–∞–Ω–æ–≤",
      "phone": "+998907654321",
      "type": "Individual",
      "totalDebt": 1200000,
      "debtsCount": 2,
      "oldestDueDate": "2025-02-10"
    }
  ],
  "total": 2,
  "page": 1,
  "size": 50
}
```

**8. –ö–ª–∏–µ–Ω—Ç —Å –¥–æ–ª–≥–æ–º –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –ø–æ–∫—É–ø–æ–∫**
```http
GET /api/clients/5/with-debt
```

–û—Ç–≤–µ—Ç:
```json
{
  "client": {
    "id": 5,
    "name": "–û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞",
    "phone": "+998901234567",
    "type": "Company"
  },
  "debt": {
    "totalAmount": 3350000,
    "debts": [
      {
        "id": 123,
        "amount": 3350000,
        "dueDate": "2025-02-18",
        "status": 0
      }
    ]
  },
  "purchases": {
    "totalAmount": 15000000,  // ‚Üê –°–ö–û–õ–¨–ö–û –í–°–ï–ì–û –ù–ê–ë–†–ê–õ –¢–û–í–ê–†–ê
    "count": 8,
    "history": [
      {
        "id": 999,
        "total": 3350000,
        "paymentType": 11,
        "createdAt": "2025-01-18T12:00:00Z"
      },
      {
        "id": 998,
        "total": 2500000,
        "paymentType": 0,
        "createdAt": "2025-01-15T10:00:00Z"
      }
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏
    ]
  }
}
```

---

## üé® UI –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - 2 –≤–∫–ª–∞–¥–∫–∏:**

**1. –ö–ª–∏–µ–Ω—Ç—ã (–æ–±—ã—á–Ω—ã–µ)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ö–ª–∏–µ–Ω—Ç—ã                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û–û–û –°–≤–µ—Ç–ª—è—á–æ–∫    +998901111111      ‚îÇ
‚îÇ –ò–ü –ü–µ—Ç—Ä–æ–≤        +998902222222      ‚îÇ
‚îÇ –§–∏–∑.–ª–∏—Ü–æ –°–∏–¥–æ—Ä–æ–≤ +998903333333      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**2. –î–æ–ª–∂–Ω–∏–∫–∏** ‚ö†Ô∏è
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –î–æ–ª–∂–Ω–∏–∫–∏                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞                   ‚îÇ
‚îÇ –î–û–õ–ì: 3,350,000 —Å—É–º üî¥              ‚îÇ
‚îÇ –°—Ä–æ–∫: 18.02.2025                    ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ –ò–ü –ò–≤–∞–Ω–æ–≤                           ‚îÇ
‚îÇ –î–û–õ–ì: 1,200,000 —Å—É–º üî¥              ‚îÇ
‚îÇ –°—Ä–æ–∫: 10.02.2025                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### **–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞                  ‚îÇ
‚îÇ  +998901234567                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üí∞ –î–û–õ–ì: 3,350,000 —Å—É–º             ‚îÇ
‚îÇ  üìÖ –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã: 18.02.2025         ‚îÇ
‚îÇ  [–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ–ª–≥]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìä –í—Å–µ–≥–æ –ø–æ–∫—É–ø–æ–∫: 15,000,000 —Å—É–º   ‚îÇ
‚îÇ  üõí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫—É–ø–æ–∫: 8           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ò–°–¢–û–†–ò–Ø –ü–û–ö–£–ü–û–ö:                   ‚îÇ
‚îÇ  18.01.2025 - 3,350,000 —Å—É–º (–¥–æ–ª–≥)  ‚îÇ
‚îÇ  15.01.2025 - 2,500,000 —Å—É–º         ‚îÇ
‚îÇ  10.01.2025 - 1,800,000 —Å—É–º         ‚îÇ
‚îÇ  ...                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### **–î–µ—Ç–∞–ª–∏ –¥–æ–ª–≥–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –î–æ–ª–≥ #123                          ‚îÇ
‚îÇ  –ö–ª–∏–µ–Ω—Ç: –û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞          ‚îÇ
‚îÇ  –°—Ä–æ–∫: 18.02.2025                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 3,350,000 —Å—É–º   ‚îÇ
‚îÇ  –û–ø–ª–∞—á–µ–Ω–æ: 0 —Å—É–º                    ‚îÇ
‚îÇ  –û—Å—Ç–∞–ª–æ—Å—å: 3,350,000 —Å—É–º            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –¢–û–í–ê–†–´:                            ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  –û–ü-1 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 1 –∫–≥             ‚îÇ
‚îÇ  –ö–æ–ª-–≤–æ: 10  –¶–µ–Ω–∞: 160,000          ‚îÇ
‚îÇ  –ò—Ç–æ–≥–æ: 1,600,000 —Å—É–º               ‚îÇ
‚îÇ  [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]                    ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  –û–ü-5 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 5 –∫–≥             ‚îÇ
‚îÇ  –ö–æ–ª-–≤–æ: 5  –¶–µ–Ω–∞: 350,000           ‚îÇ
‚îÇ  –ò—Ç–æ–≥–æ: 1,750,000 —Å—É–º               ‚îÇ
‚îÇ  [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ–ª–≥] [–ò—Å—Ç–æ—Ä–∏—è –æ–ø–ª–∞—Ç]    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚öôÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### **–¢–∞–±–ª–∏—Ü–∞: Debts**
```sql
CREATE TABLE Debts (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    ClientId INT NOT NULL,
    SaleId INT NOT NULL,
    Amount DECIMAL(18,2) NOT NULL,           -- –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞
    OriginalAmount DECIMAL(18,2) NOT NULL,   -- –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
    DueDate DATETIME(6) NOT NULL,
    Status INT NOT NULL,
    Notes TEXT NULL,
    CreatedAt DATETIME(6) NOT NULL,
    CreatedBy VARCHAR(255) NULL,
    
    INDEX IX_Debts_ClientId_Status (ClientId, Status),
    INDEX IX_Debts_DueDate (DueDate),
    FOREIGN KEY (ClientId) REFERENCES Clients(Id)
);
```

### **–¢–∞–±–ª–∏—Ü–∞: DebtItems**
```sql
CREATE TABLE DebtItems (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    DebtId INT NOT NULL,
    ProductId INT NOT NULL,
    ProductName VARCHAR(500) NOT NULL,
    Sku VARCHAR(100) NULL,
    Qty DECIMAL(18,2) NOT NULL,
    Price DECIMAL(18,2) NOT NULL,
    Total DECIMAL(18,2) NOT NULL,
    CreatedAt DATETIME(6) NOT NULL,
    UpdatedAt DATETIME(6) NULL,
    UpdatedBy VARCHAR(255) NULL,
    
    INDEX IX_DebtItems_DebtId (DebtId),
    FOREIGN KEY (DebtId) REFERENCES Debts(Id) ON DELETE CASCADE
);
```

---

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Railway CLI**
```powershell
cd c:\projectApp
railway link
Get-Content "add-debt-system-enhanced.sql" | railway run mysql
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Railway Dashboard**
1. –û—Ç–∫—Ä–æ–π Railway ‚Üí –¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç ‚Üí MySQL ‚Üí Query
2. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `add-debt-system-enhanced.sql`
3. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å—ã

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **–ú–æ–¥–µ–ª–∏:**
- `Debt` - —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ (OriginalAmount, Notes, CreatedAt, CreatedBy, Items)
- `DebtItem` - –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –¥–æ–ª–≥–µ
- `PaymentType.Debt` - –Ω–æ–≤—ã–π —Ç–∏–ø –æ–ø–ª–∞—Ç—ã

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–≥–æ–≤:**
- –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ —Å `PaymentType = Debt`
- –¢–æ–≤–∞—Ä—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ `DebtItems`
- –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã

‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤:**
- `PUT /api/debts/{id}/items`
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Å—É–º–º—ã –¥–æ–ª–≥–∞

‚úÖ **–ß–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞:**
- `POST /api/debts/{id}/pay`
- –ú–æ–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å –ø–æ —á–∞—Å—Ç—è–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–µ

‚úÖ **–°–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–∏–∫–æ–≤:**
- `GET /api/clients/debtors`
- –û—Ç–¥–µ–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –¥–ª—è UI
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—É–º–º–µ –¥–æ–ª–≥–∞

‚úÖ **–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞:**
- `GET /api/clients/{id}/with-debt`
- –¢–µ–∫—É—â–∏–π –¥–æ–ª–≥ —Å–≤–µ—Ä—Ö—É
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ —Å–Ω–∏–∑—É
- –û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫

‚úÖ **–§–∏–ª—å—Ç—Ä—ã –∏ –∑–∞–ø—Ä–æ—Å—ã:**
- –ü–æ –∫–ª–∏–µ–Ω—Ç—É, —Å—Ç–∞—Ç—É—Å—É, –¥–∞—Ç–∞–º
- –î–æ–ª–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–ª–∞—Ç

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–¥–∞–∂–∞ –≤ –¥–æ–ª–≥**

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST https://your-api.railway.app/api/sales \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "clientId": 5,
    "clientName": "–û–û–û –†–æ–≥–∞ –∏ –∫–æ–ø—ã—Ç–∞",
    "paymentType": 11,
    "debtDueDate": "2025-02-18",
    "debtNotes": "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç, —Ö–æ—Ä–æ—à–∞—è –∏—Å—Ç–æ—Ä–∏—è",
    "items": [
      { "productId": 1, "qty": 10, "unitPrice": 150000 },
      { "productId": 3, "qty": 5, "unitPrice": 350000 }
    ]
  }'
```

### **–ü—Ä–∏–º–µ—Ä 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω**

```bash
curl -X PUT https://your-api.railway.app/api/debts/123/items \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {
        "id": 1,
        "productId": 1,
        "productName": "–û–ü-1 (–ø–æ—Ä–æ—à–∫–æ–≤—ã–π) 1 –∫–≥",
        "sku": "OP-1",
        "qty": 10,
        "price": 160000,
        "total": 1600000
      }
    ]
  }'
```

### **–ü—Ä–∏–º–µ—Ä 3: –ß–∞—Å—Ç–∏—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞**

```bash
curl -X POST https://your-api.railway.app/api/debts/123/pay \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{ "amount": 1000000 }'
```

---

## üéâ –ì–û–¢–û–í–û!

**–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–≥–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

**–§–∞–π–ª—ã:**
- `Models/Debt.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- `Models/DebtItem.cs` - –Ω–æ–≤–∞—è
- `Models/PaymentType.cs` - –¥–æ–±–∞–≤–ª–µ–Ω Debt
- `Controllers/SalesController.cs` - –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–≥–æ–≤
- `Controllers/DebtsController.cs` - —Ä–∞—Å—à–∏—Ä–µ–Ω
- `Controllers/ClientsController.cs` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ª–∂–Ω–∏–∫–∏
- `Dtos/DebtDtos.cs` - –Ω–æ–≤—ã–µ DTO
- `Dtos/SaleDtos.cs` - –ø–æ–ª—è –¥–æ–ª–≥–∞
- `Data/AppDbContext.cs` - DbSet<DebtItem>
- `add-debt-system-enhanced.sql` - –º–∏–≥—Ä–∞—Ü–∏—è
- `DEBT_SYSTEM.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π —á–µ—Ä–µ–∑ Swagger! üöÄ
