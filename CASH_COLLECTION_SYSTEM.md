# üí∞ –°–ò–°–¢–ï–ú–ê –ò–ù–ö–ê–°–°–ê–¶–ò–ò –°–ï–†–´–• –î–ï–ù–ï–ì

## üìã –ö–û–ù–¶–ï–ü–¶–ò–Ø:

**–°–µ—Ä—ã–µ –ø—Ä–æ–¥–∞–∂–∏** = –ù–∞–ª–∏—á–Ω—ã–µ –±–µ–∑ —á–µ–∫–∞ + Click –±–µ–∑ —á–µ–∫–∞

–≠—Ç–∏ –¥–µ–Ω—å–≥–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏–Ω–∫–∞—Å—Å–∏—Ä—É—é—Ç—Å—è (—Å–¥–∞—é—Ç—Å—è).
–ß–∞—Å—Ç—å –¥–µ–Ω–µ–≥ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏ –∫–∞–∫ Cash Flow –∏–ª–∏ –¥–∏–≤–∏–¥–µ–Ω–¥—ã.

---

## üéØ –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê:

### **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**

```
–î–µ–Ω—å 1-7: –ü—Ä–æ–¥–∞–∂–∏ –±–µ–∑ —á–µ–∫–∞
‚îú‚îÄ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: +30 –º–ª–Ω
‚îú‚îÄ –í—Ç–æ—Ä–Ω–∏–∫: +25 –º–ª–Ω
‚îú‚îÄ –°—Ä–µ–¥–∞: +40 –º–ª–Ω
‚îú‚îÄ –ß–µ—Ç–≤–µ—Ä–≥: +35 –º–ª–Ω
‚îú‚îÄ –ü—è—Ç–Ω–∏—Ü–∞: +50 –º–ª–Ω
‚îú‚îÄ –°—É–±–±–æ—Ç–∞: +15 –º–ª–Ω
‚îî‚îÄ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: +5 –º–ª–Ω
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û –Ω–∞–∫–æ–ø–ª–µ–Ω–æ: 200 –º–ª–Ω

–ò–ù–ö–ê–°–°–ê–¶–ò–Ø (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫):
‚îú‚îÄ –ù–∞–∫–æ–ø–ª–µ–Ω–æ: 200 –º–ª–Ω
‚îú‚îÄ –°–¥–∞–Ω–æ: 180 –º–ª–Ω
‚îî‚îÄ –û—Å—Ç–∞—Ç–æ–∫: 20 –º–ª–Ω ‚Üê Cash Flow –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏

–ü–û–°–õ–ï –ò–ù–ö–ê–°–°–ê–¶–ò–ò:
‚îú‚îÄ –°—á–µ—Ç—á–∏–∫ –æ–±–Ω—É–ª–∏–ª—Å—è ‚Üí 0
‚îú‚îÄ 20 –º–ª–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
‚îî‚îÄ –ù–∞—á–∏–Ω–∞–µ—Ç –∫–æ–ø–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ

–î–µ–Ω—å 8-14: –ù–æ–≤—ã–µ –ø—Ä–æ–¥–∞–∂–∏
‚îú‚îÄ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: +0 (–∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è)
‚îú‚îÄ –í—Ç–æ—Ä–Ω–∏–∫: +28 –º–ª–Ω
‚îú‚îÄ –°—Ä–µ–¥–∞: +32 –º–ª–Ω
‚îú‚îÄ –ß–µ—Ç–≤–µ—Ä–≥: +45 –º–ª–Ω
‚îú‚îÄ –ü—è—Ç–Ω–∏—Ü–∞: +55 –º–ª–Ω
‚îú‚îÄ –°—É–±–±–æ—Ç–∞: +20 –º–ª–Ω
‚îî‚îÄ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: +10 –º–ª–Ω
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û –Ω–∞–∫–æ–ø–ª–µ–Ω–æ: 190 –º–ª–Ω

–í–¢–û–†–ê–Ø –ò–ù–ö–ê–°–°–ê–¶–ò–Ø:
‚îú‚îÄ –ù–∞–∫–æ–ø–ª–µ–Ω–æ: 190 –º–ª–Ω
‚îú‚îÄ –°–¥–∞–Ω–æ: 190 –º–ª–Ω
‚îî‚îÄ –û—Å—Ç–∞—Ç–æ–∫: 0 –º–ª–Ω

–û–ë–©–ò–ô –ù–ï–ò–ù–ö–ê–°–°–ò–†–û–í–ê–ù–ù–´–ô –û–°–¢–ê–¢–û–ö:
= 20 –º–ª–Ω (–ø–µ—Ä–≤–∞—è) + 0 –º–ª–Ω (–≤—Ç–æ—Ä–∞—è) = 20 –º–ª–Ω
```

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:

### **1. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (CashCollection):**

```csharp
public class CashCollection
{
    public int Id { get; set; }
    public DateTime CollectionDate { get; set; }        // –î–∞—Ç–∞ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏
    public decimal AccumulatedAmount { get; set; }      // –ù–∞–∫–æ–ø–ª–µ–Ω–æ
    public decimal CollectedAmount { get; set; }        // –°–¥–∞–Ω–æ
    public decimal RemainingAmount { get; set; }        // –û—Å—Ç–∞—Ç–æ–∫
    public string? Notes { get; set; }                  // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
    public string? CreatedBy { get; set; }              // –ö—Ç–æ –ø—Ä–æ–≤–µ–ª
}
```

### **2. –°–µ—Ä–≤–∏—Å (CashCollectionService):**

**–ú–µ—Ç–æ–¥—ã:**
- `GetSummaryAsync()` - –°–≤–æ–¥–∫–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `CreateCollectionAsync()` - –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—é
- `GetHistoryAsync()` - –ò—Å—Ç–æ—Ä–∏—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–π
- `DeleteLastCollectionAsync()` - –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é

**–†–∞—Å—á–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π —Å—É–º–º—ã:**
```csharp
var greyPaymentTypes = new[] 
{ 
    PaymentType.CashNoReceipt,   // 1
    PaymentType.Click,            // 3
    PaymentType.ClickNoReceipt    // 9
};

var accumulated = await _db.Sales
    .Where(s => s.CreatedAt > lastCollectionDate && 
               greyPaymentTypes.Contains(s.PaymentType))
    .SumAsync(s => s.Total);
```

---

## üîå API –≠–ù–î–ü–û–ò–ù–¢–´:

### **1. GET /api/cash-collection/summary**
–ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–ö –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏"

**Response:**
```json
{
  "currentAccumulated": 150000000,      // –ù–∞–∫–æ–ø–ª–µ–Ω–æ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π
  "lastCollectionDate": "2025-10-14",   // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏
  "totalRemainingAmount": 20000000,     // –û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
  "history": [
    {
      "id": 2,
      "collectionDate": "2025-10-14",
      "accumulatedAmount": 200000000,
      "collectedAmount": 180000000,
      "remainingAmount": 20000000,
      "notes": "–î–∏–≤–∏–¥–µ–Ω–¥—ã —É—á—Ä–µ–¥–∏—Ç–µ–ª–µ–π",
      "createdBy": "admin"
    }
  ]
}
```

### **2. POST /api/cash-collection**
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—é

**Request:**
```json
{
  "collectedAmount": 180000000,
  "notes": "–ß–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è, 20–ú –Ω–∞ –¥–∏–≤–∏–¥–µ–Ω–¥—ã"
}
```

**Response:**
```json
{
  "id": 3,
  "collectionDate": "2025-10-19T15:00:00",
  "accumulatedAmount": 200000000,
  "collectedAmount": 180000000,
  "remainingAmount": 20000000,
  "notes": "–ß–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è, 20–ú –Ω–∞ –¥–∏–≤–∏–¥–µ–Ω–¥—ã",
  "createdBy": "admin"
}
```

### **3. GET /api/cash-collection/history**
–ò—Å—Ç–æ—Ä–∏—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–π

**Query params:**
- `from` (optional) - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
- `to` (optional) - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è

### **4. DELETE /api/cash-collection/last**
–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—é (–µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞)

---

## üì± UI - –°–¢–†–ê–ù–ò–¶–ê "–ö –ò–ù–ö–ê–°–°–ê–¶–ò–ò":

### **–û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üíµ –ö –ò–ù–ö–ê–°–°–ê–¶–ò–ò                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ üìà –° –ü–û–°–õ–ï–î–ù–ï–ô –ò–ù–ö–ê–°–°–ê–¶–ò–ò:              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ   150,000,000 UZS                   ‚îÇ ‚îÇ
‚îÇ ‚îÇ   –° 14.10.2025                      ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ üíº –ù–ï–ò–ù–ö–ê–°–°–ò–†–û–í–ê–ù–ù–´–ô –û–°–¢–ê–¢–û–ö:           ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ   20,000,000 UZS                    ‚îÇ ‚îÇ
‚îÇ ‚îÇ   (Cash Flow –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏)        ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ –°—É–º–º–∞ –∫ —Å–¥–∞—á–µ:                      ‚îÇ ‚îÇ
‚îÇ ‚îÇ [__________________] UZS            ‚îÇ ‚îÇ
‚îÇ ‚îÇ                                     ‚îÇ ‚îÇ
‚îÇ ‚îÇ –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:                         ‚îÇ ‚îÇ
‚îÇ ‚îÇ [__________________________]        ‚îÇ ‚îÇ
‚îÇ ‚îÇ                                     ‚îÇ ‚îÇ
‚îÇ ‚îÇ [üì§ –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—é]            ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìú –ò–°–¢–û–†–ò–Ø –ò–ù–ö–ê–°–°–ê–¶–ò–ô                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –î–∞—Ç–∞        ‚îÇ –ù–∞–∫–æ–ø–ª–µ–Ω–æ ‚îÇ –°–¥–∞–Ω–æ ‚îÇ –û—Å—Ç–∞—Ç–æ–∫‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ 14.10.2025  ‚îÇ 200 –º–ª–Ω   ‚îÇ 180–ú  ‚îÇ 20–ú    ‚îÇ
‚îÇ 07.10.2025  ‚îÇ 350 –º–ª–Ω   ‚îÇ 350–ú  ‚îÇ  0–ú    ‚îÇ
‚îÇ 30.09.2025  ‚îÇ 280 –º–ª–Ω   ‚îÇ 250–ú  ‚îÇ 30–ú    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –û–¢–ß–ï–¢–´ –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê:

### **–ú–µ—Ç—Ä–∏–∫–∏:**

1. **–¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –∫ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏**
   - –°–µ—Ä—ã–µ –ø—Ä–æ–¥–∞–∂–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

2. **–ù–µ–∏–Ω–∫–∞—Å—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫**
   - –°—É–º–º–∞ –≤—Å–µ—Ö RemainingAmount
   - Cash Flow –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏

3. **–°—Ä–µ–¥–Ω—è—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è**
   - –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –∑–∞ N –¥–Ω–µ–π

4. **% –ò–Ω–∫–∞—Å—Å–∞—Ü–∏–∏**
   - Collected / Accumulated * 100%

### **SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**

```sql
-- –¢–µ–∫—É—â–∞—è —Å—É–º–º–∞ –∫ –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏
SELECT COALESCE(SUM(s.Total), 0) as CurrentAccumulated
FROM Sales s
WHERE s.CreatedAt > (SELECT MAX(CollectionDate) FROM CashCollections)
  AND s.PaymentType IN (1, 3, 9);

-- –û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫
SELECT COALESCE(SUM(RemainingAmount), 0) as TotalRemaining
FROM CashCollections;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
SELECT 
    COUNT(*) as Collections,
    SUM(AccumulatedAmount) as TotalAccumulated,
    SUM(CollectedAmount) as TotalCollected,
    AVG(CollectedAmount * 100.0 / AccumulatedAmount) as AvgCollectionPercent
FROM CashCollections
WHERE CollectionDate >= datetime('now', '-30 days');
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

### **–î–æ—Å—Ç—É–ø:**
- ‚úÖ **Owner** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- ‚úÖ **Admin** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- ‚ùå **Manager** - –ù–ï–¢ –¥–æ—Å—Ç—É–ø–∞ (—Å–∫—Ä—ã—Ç–æ)

### **–ê—É–¥–∏—Ç:**
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è
- –ö—Ç–æ –ø—Ä–æ–≤–µ–ª (CreatedBy)
- –ö–æ–≥–¥–∞ (CreatedAt)
- –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é

---

## üéØ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ù–ê–õ–û–ì–ê–ú–ò:

### **–û–±–Ω–æ–≤–∏—Ç—å TaxCalculationService:**

```csharp
// –†–∞–∑–¥–µ–ª–∏—Ç—å –≤—ã—Ä—É—á–∫—É –Ω–∞ –±–µ–ª—É—é –∏ —Å–µ—Ä—É—é
var whiteSales = sales.Where(s => 
    s.PaymentType == PaymentType.CashWithReceipt ||
    s.PaymentType == PaymentType.CardWithReceipt ||
    s.PaymentType == PaymentType.ClickWithReceipt ||
    s.PaymentType == PaymentType.Payme ||
    s.PaymentType == PaymentType.Contract
).ToList();

var greySales = sales.Where(s => 
    s.PaymentType == PaymentType.CashNoReceipt ||
    s.PaymentType == PaymentType.Click ||
    s.PaymentType == PaymentType.ClickNoReceipt
).ToList();

// –ù–∞–ª–æ–≥–∏ –¢–û–õ–¨–ö–û —Å –±–µ–ª–æ–π –≤—ã—Ä—É—á–∫–∏
report.TotalRevenue = whiteSales.Sum(s => s.Total);
report.GreyRevenue = greySales.Sum(s => s.Total);
```

---

## üìù –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è**
```
1. –ù–∞–∫–æ–ø–∏–ª–æ—Å—å 200 –º–ª–Ω
2. –°–¥–∞–µ–º –≤—Å–µ 200 –º–ª–Ω
3. –û—Å—Ç–∞—Ç–æ–∫ = 0
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ß–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è (–¥–∏–≤–∏–¥–µ–Ω–¥—ã)**
```
1. –ù–∞–∫–æ–ø–∏–ª–æ—Å—å 200 –º–ª–Ω
2. –°–¥–∞–µ–º 180 –º–ª–Ω
3. –û—Å—Ç–∞—Ç–æ–∫ = 20 –º–ª–Ω (–¥–∏–≤–∏–¥–µ–Ω–¥—ã —É—á—Ä–µ–¥–∏—Ç–µ–ª—è–º)
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ß–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω–∫–∞—Å—Å–∞—Ü–∏—è (—Ä–µ–∑–µ—Ä–≤)**
```
1. –ù–∞–∫–æ–ø–∏–ª–æ—Å—å 300 –º–ª–Ω
2. –°–¥–∞–µ–º 250 –º–ª–Ω
3. –û—Å—Ç–∞—Ç–æ–∫ = 50 –º–ª–Ω (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ–æ–Ω–¥)
```

---

## ‚úÖ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `CashCollection`
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `CashCollectionService`
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `CashCollectionController`
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
5. ‚è≥ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Program.cs
6. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –≤ AppDbContext
7. ‚è≥ –°–æ–∑–¥–∞—Ç—å UI —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ MAUI
8. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–∞–ª–æ–≥–æ–≤—ã–º —É—á–µ—Ç–æ–º
9. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üéâ –ò–¢–û–ì–û:

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–µ—Ä—ã–µ –ø—Ä–æ–¥–∞–∂–∏
- ‚úÖ –ü—Ä–æ–≤–æ–¥–∏—Ç—å –∏–Ω–∫–∞—Å—Å–∞—Ü–∏–∏ —Å –≥–∏–±–∫–æ—Å—Ç—å—é
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å Cash Flow –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–∏–≤–∏–¥–µ–Ω–¥—ã
- ‚úÖ –í–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
- ‚úÖ –†–∞–∑–¥–µ–ª—è—Ç—å –±–µ–ª—É—é –∏ —Å–µ—Ä—É—é –≤—ã—Ä—É—á–∫—É –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤
