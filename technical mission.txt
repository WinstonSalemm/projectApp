Техническое задание v2.0
«Система учёта продаж, склада и клиентов» (Windows + Android, облако, full-analytics)
0) Кратко о продукте

Единая облачная платформа для опта/розницы: продажи (в т.ч. нелегальные каналы), склад (НД-40/ИМ-40), клиенты/долги, возвраты, глубокая аналитика (коммерческая + финансовая + складская + операционная), прогнозы, рекомендации (акции/закуп/ценовые решения), отчётность, Telegram-уведомления, офлайн-режим. Две роли: Менеджер (только продажи/возвраты своих), Администратор (всё).

1) Роли, платформы, БД, установка

Роли: Менеджер (продажа/возврат/создание клиента), Админ (полный доступ).

Платформы: Android (менеджер/админ), Windows (админ). Позже — web/iOS.

БД: только облако (SQL). Клиенты автоподключаются (вшит ApiBaseUrl).

Офлайн: локальный кэш + синхронизация, защита от отрицательных остатков.

Установка: Windows MSI/MSIX, Android AAB/APK. Никаких ручных БД-настроек.

2) Продажи/операции (напоминание)

9 типов: Нал с чеком, Нал без чека, Карта с чеком, Click, Сайт, Биржа/договор, В долг, Payme (учёт как тип), Возврат (отдельная операция).
Правила списаний: официальные → ИМ-40; «серые» → НД-40. Возврат кладёт в регистр по происхождению. «В долг» — долг по клиенту с дедлайном.

3) Склад (НД-40/ИМ-40)

Приход, оприходование (НД→ИМ), резерв (срок/автоснятие), списание, инвентаризация, возврат, авто-архивация номенклатуры при нуле.

4) Клиенты/долги (CRM-ядро)

Карточка: ФЛ/ЮЛ, ИНН, контакты, статус (розница/опт/крупный), менеджер, история.

Долги: сумма, дата платежа, частичные оплаты, статус (актив/просроч/закрыт).

Еженедельно в Telegram — список должников (сумма/дни просрочки/менеджер).

5) Коммерческая аналитика (опт + розница)
5.1 Прайсы/цены/скидки

Прайс-листы по каналам/типу продажи (розница/опт/биржа/онлайн).

Скидки: персональные (клиент), групповые (товарная группа), разовые, акционные.

Политика минимальной маржи (блок/эскалация при риске убыточной цены).

5.2 Продажи по номенклатурам/группам/каналам

KPI: QtySold, Revenue, AvgPrice, DiscountImpact, Share%, BasketSize.

Разрезы: товар/группа, тип продажи (9), канал (касса/сайт/биржа/серые), менеджер, клиентский статус.

5.3 Тенденции и сезонность

Тренд/Δ% против прошлого периода и LY (last year), скользящие средние.

Сезонные индексы по неделям/месяцам.

5.4 Прогноз спроса (SKU/группа)

Базово: ES/MA (экспон. сглаживание/скользящее среднее), горизонт 2–8 недель.

Опция: ABC-классы с разной моделью (A — более частое обновление).

Вывод: ForecastQty, доверительный интервал, прогноз промо-подъёма (если промо).

5.5 Оборачиваемость / sell-through

AvgDailySales, DaysOfSupply, Sell-Through%, GMROII/GMROI.

Флаги: дефицит (ETA < порога), залежи (DaysOfSupply > порога).

5.6 ABC/XYZ-классификация

ABC по выручке/марже: A (топ 20%), B (средние 30%), C (низ 50%).

XYZ по стабильности спроса: X (низкая вариация), Y, Z (высокая).

Матрица ABC×XYZ для политики запасов/закупа/цен/внимания менеджеров.

5.7 Ведущие/отстающие (L/M/S)

Рейтинг по выручке, марже, обороту. Фокус-листы: лидеры к расширению, отстающие — кандидаты на акции/распродажу/снятие.

5.8 Промо-аналитика

Uplift промо vs baseline, каннибализация (внутригрупповая), net margin impact.

Пост-промо «возврат к базе», рекоменд. глубина/длительность скидки.

5.9 Формирование акций

Автоподбор кандидатов: низкая оборачиваемость, сезонный своп, окончание гарантий/моды, высокая доля склада.

Рекомендация: размер скидки для достижения целевой оборачиваемости с проверкой маржи.

5.10 Формирование закупа

TargetStockDays (настройка).

RecommendedQty = max(0, TargetDays*ForecastDailySales − CurrentStock − OnOrder + InTransit)

Приоритет: A/X, дефицитные, высокомаржинальные. Экспорт заявки (XLSX).

6) Клиентская аналитика
6.1 RFM-сегментация (Recency/Frequency/Monetary)

5×5×5 скоринг, сегменты: VIP, лояльные, спящие, новые, уходящие.

Действия: персональные предложения, удержание/реактивация.

6.2 CLV (Lifetime Value) / удержание

CLV базовый: маржа – скидки – ориентировочные расходы.

Когорты и retention-кривые; churn-сигналы (падение частоты/суммы).

6.3 Ко-покупки/ассортимент

Частые связки (market basket), рекомендованные допродажи (cross-sell).

Матрица «товар × сопутствия» для карточки заказа.

7) Финансовая аналитика (P&L/кэш/налоги)
7.1 Себестоимость/COGS

FIFO по партиям (таблица Costs), учёт логистики/надбавок → FullCost.

GrossMargin/Margin% по SKU/группам/каналам/менеджерам.

7.2 Легальные vs «серые» продажи

Автоклассификация по типу. Доли/динамика.

Налоги (НДС/акцизы) — по легальным каналам.

7.3 «Высвобожденный нал» и инкассация

FreedCash = Σ(серые продажи); ToInkass = касса+эквайринг.

Рекомендации по сдаче/оставлению в кассе (связка с подушкой V.7).

7.4 Скидки/маржа — контроль

Шкала скидок (по статусу клиента/сумме/объёму).

Флаги: «цена ниже минимальной маржи», «аномальные скидки».

7.5 Окупаемость групп / GMROII

Доходность × оборачиваемость (QUADRANT-карта).

GMROII = Валовая прибыль / Средний запас (в деньгах).

7.6 Опер. капитал и цикл денег

DIO/DSO/DPO и CCC (cash conversion cycle).

Предупреждения: рост DSO/зажатый DPO/переполненный склад (DIO↑).

7.7 Подушка безопасности (резерв ДС)

Цель CashBufferTarget (в днях затрат).

Рекомендация: сколько оставить кэша/сколько инкассировать; план пополнения/снижения.

8) Операционная аналитика (качество процессов)

Заказы/чек-аут: время оформления, ошибки, отмены/возвраты rate.

Склад: точность остатков (%), точность инвентаризаций, списания.

Доставка/отгрузка (если будет): SLA, полный/неполный комплект, цикл «заказ→выдача».

Менеджеры: конверсия лид→сделка (если введём лиды), средний чек, частота ошибок (неверный регистр/скидка сверх лимита).

9) Алёрты и сценарии решений (Decisioning)

Дефицит SKU: ETA < 7 дней → «Создать закупку».

Залежи: DaysOfSupply > 60 → «Создать акцию/уценку».

Аномальные скидки: > лимита → «Запрос подтверждения у админа».

Просрочки долгов: еженедельно в Telegram + список задач менеджерам.

Провал тренда: −X% две недели подряд → «Пересмотреть цены/промо/запасы».

Серые продажи доля↑: сигнал финансовому блоку о рисках.

10) Дашборды (только админ)

Executive (CEO/CFO): Выручка/Маржа/Лег vs Серые/CCC/DIO/DSO/DPO/Подушка/Alerts.

Коммерция: ТОП/Анти-ТОП, ABC×XYZ, Прогноз/Дефициты/Залежи, Промо-эффект, Рекоменд. закупа/акций.

Клиенты: RFM, CLV, Когорты/Retention, Должники.

Финансы: Маржа по срезам, Скидки/аномалии, Налоги, GMROII.

Операции: Скорость заказов, точность склада, возвраты.

11) Отчёты и расписания

Ежедневный (PDF): выручка по типам, маржа (агрегат), ТОПы, критичные остатки/дефицит, возвраты, серые/легальные доли.

Еженедельный (PDF): тренд по дням, ABC×XYZ смены, список должников, кандидаты в акции/закуп, промо-эффект.

Ежемесячный (PDF+XLSX): P&L слой (валовая прибыль), GMROII, CCC (DIO/DSO/DPO), структура каналов, маржа по группам/менеджерам, скидки, рекомендации на месяц.

Произвольные (XLSX): продажи/остатки/движения/долги/возвраты.

12) Данные/схема (расширение к v1.0)

PriceLists/Prices — прайс-схема.

Costs(Batches) — партии/себестоимость FIFO.

KPI_Aggregates(Period, DimType, DimId, MetricsJson) — куб для BI.

Promotions(Id, Scope, Discount%, Start, End, Goal, ForecastImpact)

DemandForecasts(SKU, Horizon, Method, Forecast, CI)

ABXTags(SKU, ABC, XYZ, UpdatedAt)

CustomerScores(ClientId, R, F, M, Segment, CLV, UpdatedAt)

OpsMetrics(Day, PickingAcc, ReturnRate, OrderCycle, …)

Alerts(Id, Type, Entity, Severity, SuggestedAction, Status)

CashPolicy(TargetDays, Rules) / CashReports(Period, Plan, Fact).

13) API (добавления)

GET /analytics/dashboard/* (executive/commercial/clients/finance/ops)

POST /analytics/forecast/run (batch)

GET /analytics/abcxyz / POST /promotions / GET /promotions/suggested

GET /procure/suggested (закуп)

GET /clients/rfm / GET /clients/debtors

GET /finance/pnl / GET /finance/ccc / GET /finance/gmroii

GET /alerts / POST /alerts/ack

POST /reports/{daily|weekly|monthly} (генерация)

14) Безопасность/качество

HTTPS, JWT, роли, шифрование локального кэша, аудит-лог, ежедневные бэкапы, валидация скидок/цен, блок отрицательных остатков, монитор «битых» транзакций/синх-ошибок.

15) UI (ключевые экраны)

Android (менеджер): Быстрая продажа (поиск/скан, доступный остаток по регистрам, 1 из 9 типов, итог), Возврат, Клиенты (создать/история/долги read-only), статус синхронизации.

Windows (админ): Дашборды (5), Склад (операции), Продажи/Возвраты (журнал/экспорт), Клиенты (фильтр «Должники»/RFM), Акции, Закуп (рекомендации), Отчёты (просмотр/планировщик), Пользователи/Настройки/Telegram.

16) Тест-план (аналитические проверки)

Корректность FIFO/COGS и маржи в P&L.

Классификация легальные/серые по типу.

Прогноз vs факт (MAPE в отчёте), пороги ABC×XYZ.

Алёрты: дефицит/залежи/скидки/просрочки — срабатывают/гаснут.

GMROII/CCC/DSO/DPO/DIO — расчёты и динамика.

RFM/CLV сегментация — стабильность сегментов, корректная фильтрация.

Промо uplift/каннибализация — базовые сравнения периодов.

17) Этапы внедрения (реалистично и быстро)

Этап 1 (База/Операции, 1–2 недели):
БД+API (Auth/Products/Clients/Stock/Costs), продажи/возвраты (9 типов), НД-40/ИМ-40 правила, долги, Telegram (события). Android: быстрая продажа, Windows: склад/журнал.

Этап 2 (Отчёты и офлайн, 1 неделя):
Ежедневный/еженедельный/ежемесячный PDF/XLSX, офлайн-кэш и синх, должники в Telegram.

Этап 3 (Аналитика v1, 1–2 недели):
ABC×XYZ, дефицит/залежи, прогноз спроса (ES/MA), закуп-рекомендации, акции-рекомендации, дашборды Commercial/Clients.

Этап 4 (Финансы/OPS v1, 1 неделя):
P&L слой (валовая), GMROII, CCC (DIO/DSO/DPO), скидки-контроль, алёрты.

Этап 5 (Шлифовка/UX/Инсталляторы, 3–5 дней):
Полировка UI, MSIX/APK, мониторинг/логи, документация.

18) Что получаем на выходе

Полная видимость: что продаётся/что нет, где деньги/маржа, где «серые» доли, где зависли запасы, где горят дефициты.

Автопрогнозы и готовые решения: «вынеси в акцию», «закупи N», «измени цену», «инкассируй столько-то».

Еженедельный контроль долгов и дисциплины скидок.